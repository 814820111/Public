<admintpl file="header" />
<style>
	.radio{
		float: left;
		padding-top: 5px;
		margin-right: 20px;
	}
	label{
		margin-bottom: 0;
		padding-top: 5px;
	}
</style>
<body class="J_scroll_fixed">
<div class="wrap jj">
	<ul class="nav nav-tabs">
		<li><a href="{:U('index')}">公众号管理</a></li>
		<li class="active"><a href="{:U('add')}">添加公众号</a></li>
	</ul>
	<div class="common-form">
		<form method="post" class="form-horizontal J_ajaxForm add-validate" action="{:U('')}">
			<fieldset>
				<div class="control-group">
					<label class="control-label">公众号名称:</label>
					<div class="controls">
						<label>
							{$wx.wx_name}
						</label>
						<!--<input type="text" class="input" name="wx_name" value="{$wx.wx_name}">-->
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">绑定学校:</label>
					<div class="controls">
						<label>
							<?php echo $wx['school_name']?>
						</label>
					</div>
				</div>
				<div class="control-group">
					<label class="control-label">选择服务器URL名称:</label>
					<div class="controls">
						<select name="" id="" onchange="getServerInfo(this.value)">
							<option value="">选择服务器URL名称</option>
							<?php foreach($server as $v){?>
							<option value="<?php echo $v['id']?>"><?php echo $v['name']?></option>
							<?php }?>
						</select>
					</div>
				</div>
				<!--<div class="control-group">-->
					<!--<label class="control-label">公众号原始ID:</label>-->
					<!--<div class="controls">-->
						<!--<input type="text" class="input" name="wx_id" value="{$wx.wx_id}">-->
						<!--<span class="must_red">*</span>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">AppId:</label>-->
					<!--<div class="controls">-->
						<!--<input type="text" class="input" name="wx_appid" value="{$wx.wx_appid}">-->
						<!--<span class="must_red">*</span>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">AppSecret:</label>-->
					<!--<div class="controls">-->
						<!--<input type="text" class="input" name="wx_appsecret" value="{$wx.wx_appsecret}">-->
						<!--<span class="must_red">*</span>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">登陆邮箱:</label>-->
					<!--<div class="controls">-->
						<!--<input type="email" class="input" name="wx_email" value="{$wx.wx_email}">-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">登陆密码:</label>-->
					<!--<div class="controls">-->
						<!--<input type="text" class="input" name="wx_password" value="{$wx.wx_password}">-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">微信号:</label>-->
					<!--<div class="controls">-->
						<!--<input type="text" class="input" name="wx_username" value="{$wx.wx_username}">-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">公众号管理员手机号:</label>-->
					<!--<div class="controls">-->
						<!--<input type="text" class="input" name="wx_mobile" value="{$wx.wx_mobile}">-->
					<!--</div>-->
				<!--</div>-->

				<!--<div class="control-group">-->
					<!--<label class="control-label">认证状态:</label>-->
					<!--<div class="controls">-->
						<!--<div class="radio">-->
							<!--<label>-->
								<!--<input type="radio" <?php if($wx[wx_is_auth]==0){echo "checked";}?> name="wx_is_auth" value="0"> 未认证-->
							<!--</label>-->
						<!--</div>-->
						<!--<div class="radio">-->
							<!--<label>-->
								<!--<input type="radio" <?php if($wx[wx_is_auth]==1){echo "checked";}?> name="wx_is_auth" value="1"> 已认证-->
							<!--</label>-->
						<!--</div>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">公众号类型:</label>-->
					<!--<div class="controls">-->
						<!--<div class="radio">-->
							<!--<label>-->

								<!--<input type="radio" <?php if($wx[wx_type]==1){echo "checked";}?> name="wx_type" value="1"> 服务号-->
							<!--</label>-->
						<!--</div>-->
						<!--<div class="radio">-->
							<!--<label>-->
								<!--<input type="radio" <?php if($wx[wx_type]==2){echo "checked";}?> name="wx_type" value="2"> 订阅号-->
							<!--</label>-->
						<!--</div>-->
					<!--</div>-->
				<!--</div>-->
				<!--<div class="control-group">-->
					<!--<label class="control-label">基本信息接口权限:</label>-->
					<!--<div class="controls">-->
						<!--<div class="radio">-->
							<!--<label>-->
								<!--<input type="radio" <?php if($wx[wx_is_get]==0){echo "checked";}?> name="wx_is_get" value="0"> 未获得-->
							<!--</label>-->
						<!--</div>-->
						<!--<div class="radio">-->
							<!--<label>-->
								<!--<input type="radio" <?php if($wx[wx_is_get]==1){echo "checked";}?> name="wx_is_get" value="1"> 已获得-->
							<!--</label>-->
						<!--</div>-->
					<!--</div>-->
				<!--</div>-->
			</fieldset>
			<div class="form-actions">
				<input type="hidden" id="hides" name="id" value="">
				<!--<button type="submit" class="btn btn-primary btn_submit J_ajax_submit_btn">添加</button>-->
				<button type="button" class="btn btn-primary btn_submit">检查</button>
				<a class="btn" href="__URL__">返回</a>
			</div>
		</form>
	</div>
</div>
<script src="__ROOT__/statics/js/common.js"></script>
<script type="text/javascript">
    $('.add-validate').validate({
        rules: {
            wx_name: {
                required: true
            },
            schoolid: {
                required: true
            },
            wx_id: {
                required: true
            },
            wx_appid: {
                required: true
            },
            wx_appsecret: {
                required: true
            },
        },
        messages: {
            school: {
                required: '请选择学校'
            },
            usermanage_id: {
                required: '请选择账号'
            },
        }
    });
    function getServerInfo(id) {
        $('.server').remove();
        $('#hides').val(id);
		$.ajax({
			type: 'post',
			url: "__ROOT__/Admin/WxManage/getInfo",
			data: {id: id},
			dataType: 'json',
			success: function (res) {
				if (res){
                	var html = '';
				    html += '<div class="control-group server"><label class="control-label">服务器地址:</label><div class="controls"><label>'+res.url;
					html += '</label></div></div>';

                    html += '<div class="control-group server"><label class="control-label">Token:</label><div class="controls"><label>'+res.token;
                    html += '</label></div></div>';

                    html += '<div class="control-group server"><label class="control-label">消息加解密密钥:</label><div class="controls"><label>'+res.encodingaeskey;
                    html += '</label></div></div>';

                    $('fieldset').append(html);
				}
            },
			error: function () {
				alert("错误");
            }
		});
    }
    $('.btn_submit').click(function () {
		var id = $('#hides').val();
        $.ajax({
            type: 'post',
            url: "__ROOT__/Admin/WxManage/checkUrl",
            data: {id: id},
            dataType: 'json',
            success: function (res) {

            },
			error: function () {

            }
        });
    })
</script>
</body>
</html>