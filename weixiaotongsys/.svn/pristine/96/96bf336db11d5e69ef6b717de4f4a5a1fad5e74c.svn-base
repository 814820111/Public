<!doctype html>
<html>

<head>
    <title>{$schoolname}</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0;" name="viewport" />
    <link rel="stylesheet" href="__TMPL__Public/Tchcss/top-box.css">
    <script src="__ROOT__/statics/wjs/jquery-3.0.0.min.js"></script>
    <link rel="stylesheet" href="__ROOT__/statics/bootstrap/css/bootstrap.min.css" />
    <script type="text/javascript" src="__ROOT__/statics/bootstrap/js/bootstrap.min.js"></script>
    <link rel="stylesheet" type="text/css" href="__TMPL__video/css/webuploader.css">
    <link rel="stylesheet" type="text/css" href="__TMPL__video/css/style.css">
    <script type="text/javascript" src="__TMPL__video/js/webuploader.min.js"></script>
    <script type="text/javascript" src="__TMPL__video/js/upload.js"></script>
    <style>
        .tijiao {
            width: 50%;
            margin-right: 25%;
            background-color: #06c18e;
            border-radius: 8px;
            border: none;
            height: 35px;
            color: white;
        }

        .xingxi {
            width: 100%;
            height: 300px;
            overflow: auto;
        }

        .xuanzediv {
            width: 15px;
            height: 15px;
            /*background-color: cornflowerblue;*/
            float: right;
            margin-top: 15px;
            border: 1px solid gray;
            position: relative;
            right: 15px;
        }

        .gou {
            position: relative;
            bottom: 3px;
            color: cornflowerblue;
        }

        .qingqiu {
            width: 100%;
            height: 20px;
            background-color: blue;
            border: none;
            position: absolute;
            top: 50px;
            left: 0px;
            background-color: white;
        }

        .img1 {
            width: 14px;
            float: right;
            margin-right: 5px;
            bottom: 10px;
        }

        .xuanqu {
            position: relative;
            left:20%;
            float: left;
        }

        .xuanze {
            font-size: 15px;
            float: left;
            margin-left: 5px;
        }

        .jiu {
            background-color: white;
            padding: 15px 10px;
            height: 40px;
        }

        .jia {
            position: relative;
            top: 10px;
        }
        .show_msg {
            width: 100%;
            height: 35px;
            text-align: center;
            position: fixed;
            left: 0;
            z-index: 999;
        }

        .show_span {
            display: inline-block;
            height: 35px;
            padding: 0 15px;
            line-height: 40px;
            background: #08B984;
            border-radius: 50px;
            color: #fff;
            font-size: 1em;
        }
        .h4, h4 {
            font-size: 14px;
        }

    </style>
</head>

<body style="background-color: #eff0f2;">
<div id="zhezhao" style="z-index:99;width: 100%;height: 100%;position: fixed;top: 0;left: 0;background: rgba(0,0,0,0.6);display: none;"></div>
<input type="hidden" value={$userid} id="userid">
<input type="hidden" value={$schoolid} id="schoolid">
<div class="top_box">
    <img src="__TMPL__Public/images/img674.png" class="fanhui"> 上传视频

    <div class="clearfix"></div>
</div>
<div class="jiang" style="margin-top: 40px;">
    <div class="jiu">

        <button class="qingqiu" class="btn btn-primary btn-lg" data-toggle="modal" data-target="#myModal">
            <div class="xuanze"  >选择班级</div>
            <span class="xuanqu" style="left:20%;" ></span>
            <img class="img1" src="__TMPL__Public/images/img69.png" >
        </button>
    </div>

    <div style="padding: 10px;background-color: white;margin-top: 10px;">
        <input class="title" type="text" style="width: 100%;border: none;" placeholder="视频名称" />
    </div>
    <div style="padding: 10px;background-color: white;margin-top: 2px;">
        <textarea class="contents" style=" width: 100%; height: 80px; resize: none;border: none;outline: none;border-bottom: 1px solid #ebebeb" placeholder="视频描述"></textarea>
        <div class="demo">
            <div id="uploadfile">
                <!--用来存放文件信息-->
                <div id="thelist" class="uploader-list"></div>
                <div class="form-group form-inline">
                    <div id="picker" style="float:left">选择文件</div> &nbsp;

                    <span style="position: absolute;font-size: 14px;margin-top: 10px">不能超过20MB</span><!--<button id="ctlBtn" class="btn btn-default" style="padding:10pMB15px;">开始上传</button>-->
                </div>
            </div>
        </div>
        <div class="clearfix"></div>
    </div>
    <div class="videoname" style="display:none"></div>
    <div>
        <button class="dianji" style="width: 35%;
            height: 35px;
            border-radius: 10px;
            border: none;
            background-color: #06c18e;
            color: white;
            margin-top: 25px;
            margin-left: 30%;">发布</button>
    </div>
</div>
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-top: 25px;">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header" style="background-color:#06c18e">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true" style="color: black;">✖</button>
                <h5 class="modal-title biaotou" id="myModalLabel" style="color: white;">接受人</h5>
            </div>
            <div class="modal-body">
                <!--模态内容部分-->

                <div class="cans" style="background-color: white;height: 400px;overflow: auto;">

                </div>

                <div class="hidew" style="width: 100%;height: 350px;">
                    <div id="jiang">
                        <div class="xixi" style="width: 100%;height: 50px;">
                            <span class="biaoti" style="position: relative;top: 10px;">全选</span>
                            <img class="tupian" src="__TMPL__Public/images/jiantou-right.png" alt="" style="position: relative;top: 10px;">
                            <div class="quanxuan" style="position: relative;bottom: 25px;right: 5px;">
                                <input id="ck" type="checkbox" style="float: right;margin-top: 15px;width:20px;height:20px;margin-right:5px;" />
                            </div>
                            <hr />
                        </div>
                        <div class="xingxi">
                            <div class="ping">


                            </div>
                        </div>
                    </div>


                </div>

            </div>
            <div class="modal-footer huis">
                <button class="tijiao" type="button" class="btn btn-default" data-dismiss="modal">确定</button>

            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal -->
</div>

<input type="hidden" class="mingzi" value="" />
<!--名字-->
<input type="hidden" class="uisid" value="" />
<!--班级id-->

</body>
</html>
<script>

    $(".xingxi").hide();

    $(".qingqiu").click(function() {
        var teacherid = $("#userid").val();
        $(".biaotou").text("选择班级");
        $(".hidew").css("height", "350");
        $(".cans").css("height", "0");
        $(".hidew").show();
        $(".huis").show();
        $(".mingzi").val("");
        $(".xuanqu").text("");
        $(".xingxi").text("");
        $(".uisid").val("");
        $("#ck").prop("checked", false);
        $.ajax({
            type: "post",
            url: '__ROOT__/index.php/?g=apps&m=teacher&a=getteacherclasslistandstudentlist',
            async: true,
            data: {
                teacherid: teacherid
            },
            dataType: 'json',
            success: function(res) {
                var html = "";
                var mingjihe = "";
                var idoiu = "";
                res = eval(res.data);
                for (var i = 0; i < res.length; i++) {
                    var name = res[i].classname; //老师名字

                    var id = res[i].classid; //老师ID
                    mingjihe += name + ",";
                    idoiu += id + ",";
                    html += '<div class="teacher" style="width: 100%;height: 50px;">'

                    html += '<span class="jia">' + name + '</span>'
                    html += '<div class="xuanzediv" >'
                    html += '<input type="hidden" class="niu" value="' + name + '"/>'
                    html += '<input type="hidden" class="idsd" value="' + id + '"/>'
                    html += '<span class="gou" style="cursor: pointer;">'
                    html += '</span>'
                    html += '</div>'
                    html += '</div>'
                }
                $(".xingxi").append(html);

                //单选框
//                    $(".xuanzediv").click(function() {
                $(".teacher").click(function() {
                    var zhi = $(".gou", this).text();
                    var hai = $(".niu", this).val() + ",";
                    var uid = $(".idsd", this).val() + ",";
                    var shurukuang = $(".mingzi").val(); //名字输入框的值
                    var uisid = $(".uisid").val() //uisid的输入框的值

                    if (zhi == '') {
                        $(".gou", this).text("✔");
                        var jia = shurukuang + hai;
                        var jiaid = uisid + uid;

                        $(".mingzi").val(jia);
                        $(".uisid").val(jiaid);

                    } else {
                        $(".gou", this).text("");
                        var str = shurukuang.replace(hai, "");
                        var strt = uisid.replace(uid, "");

                        $(".mingzi").val(str);
                        $(".uisid").val(strt);
                        var eyrut = $(".uisid").val();
                        //alert(eyrut);
                    }
                })

                //全选框
                $(".quanxuan").click(function() {
                    var checkboxdanxuan = $("input[type='checkbox']").is(':checked');
                    if (checkboxdanxuan == false) {
                        $(".gou").text("");
                        $(".mingzi").val("");
                        $(".uisid").val("");
                    } else {
                        $(".gou").text("✔");
                        $(".mingzi").val(mingjihe);
                        $(".uisid").val(idoiu)
                    }
                })




            },
            error: function() {
                console.log('系统错误,请稍后重试');
            }
        });

    });

    //模态框确定按钮
    $(".tijiao").click(function() {
        var mingfuzhi = $(".mingzi").val();
        var arr = mingfuzhi.split(',').length - 1; //报名的人数
        var lengthk = mingfuzhi.length;

        if (lengthk > 10) {
            var Strp = mingfuzhi.substring(0, 7) + "......";
        } else {
            var Strp = mingfuzhi;
        }
        var eyrut = $(".uisid").val();

        if (eyrut != "") {
            $(".xuanqu").text("" + Strp + "共选" + arr + "班");
        }
    });

    // 发布教师下拉框
    $(".xixi").click(function() {

        var transportid = $('.tupian').attr("src");
        if (transportid == "__TMPL__Public/images/jiantou-right.png") {
            $(".tupian").attr("src", "__TMPL__Public/images/jiantou2.png")
            $(".xingxi").show();
        } else {
            $(".tupian").attr("src", "__TMPL__Public/images/jiantou-right.png")
            $(".xingxi").hide();
        }
    });

    function showMsg(text, position) {
        var show = $('.show_msg').length
        if (show > 0) {

        } else {
            var div = $('<div></div>');
            div.addClass('show_msg');
            var span = $('<span></span>');
            span.addClass('show_span');
            span.appendTo(div);
            span.text(text);
            $('body').append(div);
        }
        $(".show_span").text(text);

        $(".show_msg").css('bottom', '70%');

        $('.show_msg').hide();
        $('.show_msg').fadeIn(1200);
        $('.show_msg').fadeOut(1200);
    }

    //点击提交
    $(".dianji").click(function() {
        var classid = $(".uisid").val();//班级ID
        var title = $(".title").val();//标题
        var contents = $(".contents").val();//视频描述
        var user_id = $("#userid").val();//用户ID
        var schoolid = $("#schoolid").val();//学校ID
        var videoname = $.trim($(".videoname").text());//视频
        if (classid == "") {
            showMsg('请选择班级', 'top');
            return;
        }
        if (title == "") {
            showMsg('请填写视频名称', 'top');
            return;
        }
        if (contents == "") {
            showMsg('请填写视频描述', 'top');
            return;
        }
        if (videoname == "") {
            showMsg('请上传视频', 'top');
            return;
        }
        $.ajax({
            type: "post",
//            url: '__ROOT__/index.php/?g=apps&m=index&a=AddSchoolCourseware',
            url: '{:U("video_post")}',
            async: true,
            data: {
                classid: classid,
                user_id: user_id,
                title: title,
                videoname: videoname,
                schoolid: schoolid,
                contents: contents
            },
            dataType: 'json',
            success: function(res) {
                if(res.success==1){
                    showMsg('发布成功', 'top');
                    location.href="__ROOT__/index.php/weixin/Video/videoIndex/classid/{$classid}";
                }else{
                    showMsg('发布失败', 'top');
                }

            },
            error: function() {
                showMsg('发布失败,请稍后再试', 'top');
            }
        })
    });

    $(".fanhui").click(function() {
        location.href="__ROOT__/index.php/weixin/Video/videoIndex/classid/{$classid}";
    })
</script>
<script>
    $(function(){
        var $list = $('#thelist'),
            $btn = $('#ctlBtn');

        var uploader = WebUploader.create({
            resize: false, // 不压缩image
            swf: 'js/uploader.swf', // swf文件路径
            server: '{:U("upload")}', // 文件接收服务端。
            pick: '#picker', // 选择文件的按钮。可选
           // chunked: true, //是否要分片处理大文件上传
            //chunkSize:5*1024*1024, //分片上传，每片2M，默认是5M
            auto: true, //选择文件后是否自动上传
            fileNumLimit:1
            // chunkRetry : 2, //如果某个分片由于网络问题出错，允许自动重传次数
            // runtimeOrder: 'html5,flash'


        });
        // 当有文件被添加进队列的时候
        uploader.on( 'fileQueued', function( file ) {
            $list.append( '<div id="' + file.id + '" class="item">' +
                '<h4 class="info">' + file.name + '</h4>' +
                '<p class="state">等待上传...</p>' +
                '</div>' );
        });
        // 文件上传过程中创建进度条实时显示。
        uploader.on( 'uploadProgress', function( file, percentage ) {
            var $li = $( '#'+file.id ),
                $percent = $li.find('.progress .progress-bar');

            // 避免重复创建
            if ( !$percent.length ) {
                $percent = $('<div class="progress progress-striped active">' +
                    '<div class="progress-bar" role="progressbar" style="width: 0%">' +
                    '</div>' +
                    '</div>').appendTo( $li ).find('.progress-bar');
            }

            $li.find('p.state').text('上传中');

            $percent.css( 'width', percentage * 100 + '%' );
        });
        // 文件上传成功
        uploader.on( 'uploadSuccess', function( file ,response) {
            console.log(response);
            if(response.success==1){
                var videoname = response.name+",";
                $(".videoname").append(videoname);
                $( '#'+file.id ).find('p.state').text('已上传');
            }
            if(response.success==2){
                $( '#'+file.id ).find('p.state').text(response.date);
            }
        });

        // 文件上传失败，显示上传出错
        uploader.on( 'uploadError', function( file ) {
            $( '#'+file.id ).find('p.state').text('上传出错');
        });
        // 完成上传完
        uploader.on( 'uploadComplete', function( file ) {
            $( '#'+file.id ).find('.progress').fadeOut();
        });

        $btn.on('click', function () {
            if ($(this).hasClass('disabled')) {
                return false;
            }
            uploader.upload();
            // if (state === 'ready') {
            //     uploader.upload();
            // } else if (state === 'paused') {
            //     uploader.upload();
            // } else if (state === 'uploading') {
            //     uploader.stop();
            // }
        });

    });
</script>