<teachertpl file="header"/>
<html>
<head>
<style>
</style>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>信息1</title>
<link rel="stylesheet" href="__ROOT__/statics/simpleboot/css/bootstrap_message.css">
<link href="__ROOT__/statics/simpleboot/css/fileinput_message.css" media="all" rel="stylesheet" type="text/css" />
<link href="__ROOT__/statics/js/artDialog/skins/default.css" rel="stylesheet" />
<script type="text/javascript" src="__ROOT__/statics/js/jquery.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="__ROOT__/statics/js/fileinput.js" type="text/javascript"></script>
<script src="__ROOT__/statics/js/fileinput_locale_zh.js" type="text/javascript"></script>
    <script src="__ROOT__/statics/js/jquery.js"></script>
    <script src="__ROOT__/statics/js/wind.js"></script>
    <script src="__ROOT__/statics/simpleboot/bootstrap/js/bootstrap.min.js"></script>
<style type="text/css">
.col-auto { overflow: auto; _zoom: 1;_float: left;}
.col-right { float: right; width: 30%; overflow: hidden; margin-left: 6px; }
.table th, .table td {vertical-align: middle;}
.picList li{margin-bottom: 5px;}
.touchlei{ background-color:#eeeeee;}
tr .pai,tr .pai2{ text-align:center;}
tr .pai{ background-color:#e2e2e2;}
tr .pai2{}
.clearfix{ clear:both;}
.name{ margin-right:10px;}
.dbzr{ background-color:#61c881; color:white; text-align:center; padding:0px 15px; float:left; border-radius:8px;}
.sic{ width:15px; margin-left:5px; margin-top:-15px; cursor:pointer;}
.daiban{border-bottom:1px solid #dddddd;}
.daike{ width:100px; text-align:center; line-height:30px; float:left;border-bottom:1px solid #dddddd;}
.dailei{ border:1px solid #dddddd; border-bottom:none; font-weight:bold;}
.banji{ float:left; width:20%; margin-bottom:10px;}
.banji input{ margin-top:-2px; margin-right:5px;}
.subject{ float:left; color:#03a9f4; margin-right:15px; cursor:pointer;}
.peizhi{ color:#03a9f4;}
.kecheng{ color:#03a9f4; float:left; display:none; border:1px solid #03a9f4; padding-left:3px; padding-right:3px; cursor:pointer;}
.subinput{ display:none;}
.newbox div{float:left; width:20%; margin-bottom:10px;}
.newbox div input{ margin-top:-2px; margin-right:5px;}
.add_btn{border:none; background-color:#26a69a; color:white; border-radius:5px; padding:5px 10px 5px 10px; width: 76px;cursor: pointer;}
.addzu{ display: none; }
</style>

</head>
<body>
<div class="">
    <ul id="myTab" class=" nav-tabs" style=" margin-top:30px; height:30px; list-style:none;">
   		<li><a href="{:U('index')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;">教师组管理</a></li>
      <li class="active"><a href="{:U('add')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;" class="touch">学生组管理</a></li>
   	</ul>

    <!--代班代课start-->
    	<div style=" background-color:rgba(0,0,0,0.7); width:100%; height:100%; position:absolute; display: none; " class="bantan">
        		<div style=" width:800px; background-color:white; margin-left:auto; margin-right:auto; margin-top:5%; padding:20px; position:relative;">
                	<div style=" margin-top:10px; margin-bottom:30px;">
                    	<div class="daiban" style=" width:150px; text-align:center; line-height:30px; float:left;">查看并设置成员</div>
                        <div class="clearfix"></div>
                        <div style=" border-bottom:1px solid #dddddd; margin-left:150px; margin-top:-1px;"></div>
                    </div>
                    <form action="" method="post" class="daiban_box">
						            <div>
                        	   学生姓名：
                             <input type="text" class="teacher_name" style="height: 30px; margin-top: 10px;" oninput="searchRequest()">
                             <input type="submit" style=" border:none; background-color:#26a69a; color:white; border-radius:5px; padding:5px 10px 5px 10px;" value="查询" />
                        </div>
                        <div style=" height:200px; overflow-y:scroll; padding:10px; padding-left:0;" class="class_info">
                          <foreach name="teacher" item="vo">
                        	  <div class="banji" style=" float:left; width:20%; margin-bottom:10px;">
                            	<input type="checkbox" name="class_else" value="{$vo.userid}" style=" border-width: 1px;"><span class="xxxx">{$vo.stu_name}</span>
                            </div>
                          </foreach>
                        <div class="clearfix"></div>
                        <div class="newbox">
                            
                        </div>
                        </div>
                        <div style=" width:60px; margin-left:auto; margin-right:auto; margin-top:20px;">
                        	<input type="submit" value="保存" style=" border:none; background-color:#26a69a; color:white; border-radius:3px; padding:5px 15px 5px 15px;" onclick='sub_department()'>
                           
                        </div>
                    </form>
                    <!--关闭start-->
                    <img src="__ROOT__/statics/images/cha.png" style=" position:absolute; top:20px; right:20px; width:15px; height:15px; cursor:pointer;" class="guan">
                    <!--关闭end-->
                </div>
        </div>
    <!--带班代课end-->
    <!--添加分组start-->
      <div style=" background-color:rgba(0,0,0,0.7); width:100%; height:100%; position:absolute;" class="addzu">
            <div style=" width:800px; background-color:white; margin-left:auto; margin-right:auto; margin-top:5%; padding:20px; position:relative;">
                  <div style=" margin-top:10px; margin-bottom:30px;">
                      <div class="daiban" style=" width:100px; text-align:center; line-height:30px; float:left;">添加分组</div>
                        <div class="clearfix"></div>
                        <div style=" border-bottom:1px solid #dddddd; margin-left:100px; margin-top:-1px;"></div>
                    </div>
                    <input type="hidden" name="status" value="1">
                    <form action="" method="post" class="daiban_box">
                      <div style=" width: 500px; margin-left: auto; margin-right: auto;">
                        <div>
                          分组名称:<input type="text" style=" height: 30px; width: 60%; margin-top: 10px; margin-left: 10px;border-width:1px" name="dep_name">
                          <span style="color: red;">*</span><span>必填</span>
                        </div>
                        <div>
                          分组序号:<input type="text" style=" height: 30px; width: 60%; margin-top: 10px; margin-left: 10px;border-width:1px" name="dep_id">
                        </div>    
                      </div>
                      <div style=" width:60px; margin-left:auto; margin-right:auto; margin-top:20px;">
                          <input type="submit" value="保存" style=" border:none; background-color:#26a69a; color:white; border-radius:3px; padding:5px 15px 5px 15px;" onclick='save()'>
                           
                        </div>
                    </form>
                    <!--关闭start-->
                    <img src="__ROOT__/statics/images/cha.png" style=" position:absolute; top:20px; right:20px; width:15px; height:15px; cursor:pointer;" class="guan2">
                    <!--关闭end-->
                </div>
        </div>
    <!--添加分组end-->
   	<div id="myTabContent" class="tab-content" style=" padding-left:30px; padding-right:30px;">
		<div class="tab-pane fade in active" id="home">
        	<br/>
			<form class="form-horizontal J_ajaxForm" action="{:u('index')}" method="post">
          <div class="search_type cc mb10">
              <div class="mb10" >
                
                  
                      <div class="add_btn" style="width: 80px;">添加分组 </div>
                  
              </div>
          </div>
			</form>
      <form class="J_ajaxForm" action="" method="post">
            <div class="table-responsive">
                      <table class="table table-hover table-bordered table-list">
                        <thead>
                          <tr style="background-color:#CCC;">
                            <th class="pai" style=" border-left: none;border-width: 0.5px;">分组序号</th>
                            <th class="pai" style=" border-left: none;border-width: 0.5px;">分组名称</th>
                            <th class="pai" style=" border-left: none;border-width: 0.5px;">分组成员</th>
                            <th class="pai" style=" border-left: none;border-width: 0.5px;">分组人数</th>     
                            <th class="pai" style=" border-left: none;border-width: 0.5px;border-right: none;">操作</th>
                          </tr>
                        </thead>
                        <foreach name="department" item="vo">
                        <tr>
                           <td class="pai2 cid" style=" border-left: none;border-top:none;">{$vo.number}</td>
                           <td class="pai2" style=" border-left: none;border-top:none;">{$vo.name}</td>
                           <td class="pai2 banzhuren banbox" style=" color:#00c1dd; cursor:pointer;border-top: none;border-left: none;">
                              <input type="hidden" class="de_id" value="{$vo.id}">
                              查看
                           </td>
                           <td class="pai2" style=" border-left: none;border-top:none;">{$vo.count}</td>
                           <td class="pai2" style=" border-left: none;border-top:none;border-right: none;">
                             <a href="{:U('delete',array('id'=>$vo['id']))}"  class="J_ajax_del" style=" color:#00c1dd;">
                             <if condition="$vo['count'] neq 0">
                             <elseif condition="$vo['stu_count'] eq 0"/> 
                             删除
                             </if>
                             </a>
                             <span style=" color:#00c1dd; cursor: pointer;" class="banzhuren">
                             <input type="hidden" class="de_id" value="{$vo.id}">
                             修改
                             </span>
                           </td>
                        </tr>
                        </foreach>
                    </table>
                    <div class="pagination">{$Page}</div>
                  </div>
                </form>
        </div>
        </div>
	<div class="tab-pane fade" id="ios">
	</div>
</div>
<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="__ROOT__/statics/js/common.js"></script>
<script type="text/javascript">
$(".bantan").hide();
$(".banzhuren").click(
    function(){
      $(".bantan").show();
      $(".banji input").prop("checked",false);
      //获取刚进入弹窗时所有班级的id
      de_id=$(this).children(".de_id").val();
      // tea_id=$(".t_id").val();
      $.getJSON("__ROOT__/index.php?g=teacher&m=Group&a=department_teacher&department_id="+de_id,{},function(data){
          if(data.status=="success"){
              for(var key in data.data){
                  var teacherid=data.data[key]["teacher_id"];
                  $(".banji input").each(function(){
                      if(teacherid==$(this).val()){
                          $(this).prop("checked",true);
                      }
                  });   
              }
          }
      }); 
    }
 )
//监听input
function searchRequest(){
    $(".newbox").empty();
    $(".banji").remove();
    var teacher_name=$(".teacher_name").val();
    $.getJSON("__ROOT__/index.php?g=teacher&m=Group&a=student_search&teacher_name="+teacher_name,{},function(data){
        if(data.status=="success"){
          for(var key in data.data){
            $(".newbox").append("<div class=gra_cla>"+"<input type=checkbox id=test name=test value="+data.data[key]["userid"]+">"+data.data[key]["stu_name"]+"</div>");
          }
          $.getJSON("__ROOT__/index.php?g=teacher&m=Group&a=teacher_in&de_id="+de_id,{},function(date){
                if(date.statues=="success"){
                    for(var words in date.date){
                        var t_cla=date.date[words]["teacher_id"]; 
                        var boxes = document.getElementsByName("test");
                        for(i=0;i<boxes.length;i++){
                            if(boxes[i].value == t_cla){
                                boxes[i].checked = true;
                                break
                            }
                        }
                    }
                }
            });
        }
    });
}
//关闭弹窗
$(".guan").click(
  function(){
    $(".bantan").hide()
  }
)
function sub_department() {
    var teacher_val=$("#test").index();
    if(teacher_val!=-1){
      var obj = document.getElementsByName("test");
    }else{
      var obj = document.getElementsByName("class_else");
    }
    check_val = [];
    for(k in obj){
        if(obj[k].checked)
            check_val.push(obj[k].value);
    }
    $.ajax({
      type:"post",
      async:false,
      url:"{:U('Teacher/Group/save_relation')}",
      data:{'department_id': de_id,'teacher_arr':check_val},
      success: function(msg){
        history.go(0);
      }
    });
}
</script>
<script type="text/javascript">
  //添加分组
  $(".add_btn").click(
    function(){
      $(".addzu").show()
    }
    )
  $(".guan2").click(
      function(){
        $(".addzu").hide()
      }
    )
  function save(){
    var dep_name = $("input[name='dep_name']").val();
    var dep_id = $("input[name='dep_id']").val();
    var status = $("input[name='status']").val();
    $.ajax({
      type:"post",
      async:false,
      url:"{:U('Teacher/Group/save_de')}",
      data:{'dep_name': dep_name,'dep_id':dep_id,'status':status},
      success: function(msg){
        history.go(0);
      }
    });
  }
</script>
                                 <script>
            $(".touch").mouseenter(
					function(){
						$(".touch").addClass("touchlei")
						}
			)
			 $(".touch").mouseleave(
					function(){
						$(".touch").removeClass("touchlei")
						}
			)
            </script>
</body>
</html>
