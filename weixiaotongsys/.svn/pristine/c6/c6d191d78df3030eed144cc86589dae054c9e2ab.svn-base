<admintpl file="header" />
<script src="__ROOT__/statics/js/layer/layer.js" type="text/javascript"></script>
<style>


	.wraps {
		width: 120px;
		white-space: nowrap;
		text-overflow: ellipsis;
		overflow: hidden;
		color: black;
	}
	
	.chzn-container-single .chzn-single {
		position: relative;
		top: 12px;
		height: 29px;
	}
	
	.mohu {
		width: 100px;

		bottom: 30px;
		left: 30px;
		background-color: whitesmoke;
	}

		.dbzr {
				background-color: #61c881;
				color: white;
				text-align: center;
				padding: 0px 15px;
				float: left;
				border-radius: 8px;
			}
			


   	.sic {
				width: 15px;
				margin-left: 5px;
				margin-top: -15px;
				cursor: pointer;
			}

	table td{
		color: black;
	}		
    
    span {
    	color: black;
    }

    div{
    	color: black;
    }


</style>

<!--修改模态框-->
<div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="width: 700px; left: 45%;">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header"  style="background: white">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h5 class="modal-title" id="myModalLabel" style="color: black; font-weight:bold;"></span>&nbsp;费用</h5>
			</div>
			<div class="modal-body">

				<input type="hidden" class="school">
				<div>

				</div>
				<form class="">
					<div style=" margin-top:30px; margin-bottom:15px; margin-left:30px;" class="numberic">


						<div class="clearfix"></div>
					</div>
					<div style=" margin-bottom:10px; margin-left:30px;">
						<form>

							<div style=" margin-top:8px;">
								<div style=" float:left; width:14px; height:14px; border-radius:50%; background-color:#e84e40; margin-top:3px; margin-right:10px;"></div>
								<div style=" float:left;">该栏目填写的是收取费用</div>
								<div class="clearfix"></div>
							</div>
							<div style=" margin-bottom:20px;">
								<span style=" margin-left:10px; margin-right:5px;">费用</span>
								<input type="hidden" name="charge_id" class="charage_id">
								<input type="text" name="charge"  style="margin-bottom:10px; margin-top: 5px; margin-left:5px; width:90px;" placeholder="请输入费用" value="">
							</div>


						</form>
					</div>

					<div style=" width:60px; margin-left:auto; margin-right:auto; margin-top:20px;">
						<!--<input type="submit" value="保&nbsp;存" style=" border:none; background-color:#26a69a; color:white; border-radius:3px; padding:5px 15px 5px 15px;" '>-->

					</div>
				</form>


			</div>
			<div class="modal-footer">

				<button type="button" class="btn btn-default guan1" data-dismiss="modal" style="background: white; color:black; font-weight:bold;">关闭</button>
				<button type="button" class="btn btn-primary " style="display: block;float: right;font-weight:bold;" onclick='sub_charge()'>提交更改</button>


			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal -->
</div>
<!--增加明细-->
<div class="modal fade" id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
	<div class="modal-dialog">
		<div class="modal-content">
			<div class="modal-header"  style="background: white">
				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
				<h5 class="modal-title" id="myModalLabe2" style="color: black; font-weight:bold;"><span class="ICname" style="color: #3a87ad;"></span>增加明细</h5>
			</div>
			<div class="modal-body">

				<input type="hidden" class="school">
				<!--<div>-->
					<!--<div style=" cursor: pointer;">-->
						<!--<ul class=" nav-tabs" style="height:30px; list-style:none;">-->

							<!--<li class="active" id="huoqu">-->
								<!--<a style="color:#1f1f1f; text-decoration:none; padding:10px 15px;" class="touch">家长IC卡设置</a>-->
							<!--</li>-->
						<!--</ul>-->
					<!--</div>-->
				<!--</div>-->


				<div class="jiaz" style="margin-top: 10px;cursor: pointer; display: block;">
					<div>
						<span>班级：</span>
						<select class="selss" name="char_classid"  style="width: auto;">
							<option value="">请选择</option>
							<foreach name="class" item="vo">
								<option value="{$vo.id}" >{$vo.classname}</option>
							</foreach>
						</select>
					</div>
					<br>
					<div>
						<span>学生：</span>
						<select class="selstu" name="char_studentid"  style="width: auto;">
							<option value="">请选择</option>
							<!--<foreach name="class" item="vo">-->
								<!--<option value="{$vo.id}" >{$vo.classname}</option>-->
							<!--</foreach>-->
						</select>
					</div>
					<br>
					<div>
						<span>费用：</span>
						<input type="text" class="a2" name="char_charge" data-id=""/>
					</div>
					<div>
						<span>号码：</span>
						<input type="text" class="a3" name="char_phone" data-id=""/>
					</div>

				</div>
			</div>
			<div class="modal-footer">

				<button type="button" class="btn btn-default gb" data-dismiss="modal" style="background: white; color:black; font-weight:bold;">关闭</button>
				<button type="button" class="btn btn-primary si" style="float: right;font-weight:bold;" onclick='sub_add()'>提交更改</button>

			</div>
		</div>
		<!-- /.modal-content -->
	</div>
	<!-- /.modal -->
</div>

<body class="J_scroll_fixed">

	<div class="wrap J_check_wrap">
		<ul class="nav nav-tabs">

			<li><a href="{:U('student_charge_index')}">返回</a></li>
			<li  class="active"><a>费用明细</a></li>

		</ul>

		<form class="well form-search" method="get" action="{:U('charge_detail')}">
			<div class="search_type cc mb10">
				<div class="mb10">
					<span class="mr20">
					<input type="hidden" name="schoolid" value="{$schoolid}">
					<input type="hidden" name="packageid" value="{$packageid}">
					<input type="hidden" name="service_charge_id" value="{$service_charge_id}">

					班级:
					<select class="select_1" name="classid" id="cis" style="width: auto;">
						  <option value="">全部</option>
						 <foreach name="class" item="vo">
							 <option value="{$vo.id}" <?php if($classid==$vo["id"]) echo("selected");?> >{$vo.classname}</option>
                        </foreach>
				   </select> &nbsp;&nbsp;
						<select class="mohu" name="tiaojian">

						    <option value="0">查询类型</option>

							<option value="name"  <?php if($tiaojian==name) echo("selected");?> >学生名字</option>

							<option value="phone" <?php if($tiaojian==phone) echo("selected");?>>手机号码</option>
						</select>
					    <input type="text" placeholder="根据条件进行模糊查询" name="shuzhi" class="zhi" value="{$shuzhi}">

						时间：
						<input type="text" name="start_time" placeholder="请选择" class="J_date" value="{$start_time|default=''}" style="width: 80px;" autocomplete="off">
						 <input type="text" class="J_date" placeholder="请选择" name="end_time" value="{$end_time}" style="width: 80px;" autocomplete="off"> &nbsp; &nbsp;
						<div style="    display: inherit;">
                        <a class="btn btn-danger" href="{:U('charge_detail',array('schoolid'=>$schoolid,'packageid'=>$packageid,'service_charge_id'=>$service_charge_id))}">清空</a>
                        <!--<button class="btn btn-danger" type="reset">清空</button>-->
						<!--<input type="button" class="btn btn-success daochu" value="导出" />-->

						<input type="submit" class="btn btn-primary ss" value="搜索" />
						<a   class="btn btn-success add"   data-toggle="modal" data-target="#myModal4"  style="background-color: transparent; cursor: pointer;">增加</a>
						</div>
					</span>
				</div>
			</div>

		</form>

		<form class="J_ajaxForm" action="" method="post">
			<div class="table-actions">
				<!-- 				<button class="btn btn-primary btn-small J_ajax_submit_btn" type="submit" data-action="{:U('Student/listorders')}">排序</button> -->
				<!-- <button class="btn btn-primary btn-small J_ajax_submit_btn" type="submit" data-action="{:U('Stuent/check',array('check'=>1))}" data-subcheck="true">审核</button>
				<button class="btn btn-primary btn-small J_ajax_submit_btn" type="submit" data-action="{:U('Stuent/check',array('uncheck'=>1))}" data-subcheck="true">取消审核</button> -->
			</div>
			<table class="table table-hover table-bordered table-list">
				<thead>
					<tr>
						<th align='center'><input type='checkbox' id='checkAll' name="checkAll" style="    vertical-align: -2px;">选择</th>
						<th>SA</th>
						<th>学校</th>
						<th>班级</th>
						<th>学生名字</th>
						<th>手机号码</th>
						<th>服务名称</th>
						<th>收取费用</th>
						<th>日期</th>
						<th>类型</th>
						<th>使用月数</th>
						<th align='center'>操作</th>
					</tr>
				</thead>
				<foreach name="result" item="vo">
					<tr>
						<td class="aaa"><input type="checkbox" class="J_check" data-yid="J_check_y" data-xid="J_check_x" name="ids[]" value="{$vo.id}" title="ID:"></td>
						<td>{$vo.agentname}</td>
						<td>{$vo.school_name}</td>
						<td>{$vo.classname}</td>
						<td>{$vo.studentname}</td>
						<td>{$vo.phone}</td>
						<td>
							{$vo.packagename}
						</td>
						<td>{$vo.charge}</td>
						<td>
							{$vo.add_timeint|date="Y-m-d H:i:s",###}
						</td>
						<td>
							<if condition="$vo['type'] eq 1">
								月份
							</if>
							<if condition="$vo['type'] eq 2">
								学期
							</if>
							<if condition="$vo['type'] eq 4">
								学年
							</if>
						</td>
						<td>{$vo.month}</td>
						<td>
							<a  class="btn-lg" data-id={$vo['id']}  data-toggle="modal" data-target="#myModal1"  style="background-color: transparent; cursor: pointer;">修改</a>
						</td>
					</tr>
				</foreach>

			</table>
			<div class="pagination">{$Page}</div>

		</form>


	</div>
	<script src="__ROOT__/statics/js/common.js"></script>
	<script src="__ROOT__/statics/chosen/chosen.jquery.js"></script>
	<script>
        $(document).ready(function(){
            var htmls = "";
            htmls+='<option  value="">请选择</option> ';
            $(".selstu").html(htmls);
        });
		//选择班级 拉取学校
        $(".selss").change(function(){
            var htmls = "";
            htmls+='<option  value="">请选择</option> ';
            $(".selstu").html(htmls);
            var classid = $(".selss  option:selected").val();
            var schoolid = $("input[name='schoolid']").val();
            if(classid && schoolid){
                $.ajax({
                    type:"post",
                    url:  "{:U('student_info')}",
                    async:true,
                    data:{
                        classid:classid,
                        schoolid:schoolid
                    },
                    dataType: 'json',
                    success: function(res) {
                        console.log(res);
                        if(res.state>0){
							var html = "";
							html+='<option  value="">请选择</option> ';
							res = eval(res.success);
							for(var i = 0; i < res.length; i++) {
								var stu_name=res[i].stu_name;//学生的名称
								var userid=res[i].userid;//学校的ID
								html+='<option class="Sio" value="'+userid+'">'+stu_name+' </option> '
							}
							$(".selstu").html(html)
						}else{
                            alert(res.success)
						}


                    },
                    error: function() {
                        console.log('系统错误,请稍后重试');
                    }
                });
			}else{
                alert("缺少参数");
			}

        })
        $(".daochu").click(function(){
            var typeschool = $(".chzn-select  option:selected").val();
            if(typeschool == "") {
                alert("请选择学校");
                return;
            }

            location.href="{:U('Lexcel')}?schoolid="+typeschool ;
		});

 	   $(function() {
            $("#checkAll").click(function() {
                $('input[class="J_check"]').prop("checked", $(this).prop("checked"));
            });
            var $J_check = $("input[class='J_check']");
            $J_check.click(function(){
                $("#checkAll").prop("checked",$J_check.length == $("input[class='J_check']:checked").length ? true : false);
            });
        });


        $(".btn-lg").click(function(){
            var id = $(this).attr('data-id');
            $(".charage_id").attr("value",id);
        });

        //修改
        function sub_charge() {
            charge_id = $("input[name='charge_id']").val();
            charge = $("input[name='charge']").val()
            schoolid = $("input[name='schoolid']").val();
            packageid = $("input[name='packageid']").val()
            service_charge_id = $("input[name='service_charge_id']").val();
			if(charge){
                if(!isNaN(charge)){
                    $.ajax({
                        type: "post",
                        async: false,
                        url: "{:U('edit_charge_detail')}",
                        data: {
                            'charge_id': charge_id,
                            'charge':charge,
                            'schoolid':schoolid,
                            'service_charge_id':service_charge_id,
                            'packageid':packageid
                        },
                        dataType:'json',
                        success: function(res) {
                            if(res.state>0){
                                alert(res.success);
                                history.go(0);
                            }else{
                                alert(res.success);
                            }

                        },
                        error: function() {
                            console.log('系统错误,请稍后重试');
                        }
                    });
                }else{
                    alert("请输入数字格式的费用");
                    return;
                }

			}else{
			    alert("请输入费用");
			    return;
			}

		}

		//添加
        function sub_add() {
            var service_charge_id = $("input[name='service_charge_id']").val();

            var classid = $(".selss  option:selected").val();

            var studentid = $(".selstu  option:selected").val();

            var charge = $("input[name='char_charge']").val();
            var phone = $("input[name='char_phone']").val();

            if(classid==""){
                alert("请选择班级");
                return;
			}
            if(studentid==""){
                alert("请选择学生");
                return;
            }
            if(service_charge_id==""){
                alert("缺少参数");
                return;
            }


            var myreg = /^(((13[0-9]{1})|(14[0-9]{1})|(17[0]{1})|(15[0-3]{1})|(15[5-9]{1})|(18[0-9]{1}))+\d{8})$/;
            if(phone == ''){
               alert("请输入手机号码")
				return;
            }else if(phone.length !=11){
                alert("请输入有效的手机号码！");
                return;
            }else if(!myreg.test(phone)){
                alert("请输入有效的手机号码！");
                return;
            }

            if(charge){
                if(!isNaN(charge)){
                    $.ajax({
                        type: "post",
                        async: true,
                        url: "{:U('add_charge_detail')}",
                        data: {
                            'charge':charge,
                            'classid':classid,
                            'service_charge_id':service_charge_id,
                            'phone':phone,
                            'studentid':studentid
                        },
                        dataType:'json',
                        success: function(res) {
                            console.log(res);
                            if(res.state>0){
                                alert(res.success);
                                history.go(0);
							}else{
                                alert(res.success);
							}

                        }
                    });
                }else{
                    alert("请输入数字格式的费用");
                    return;
                }

            }else{
                alert("请输入费用");
                return;
            }

        }
		$(function() {
			$("[data-toggle='tooltip']").tooltip();
		});

		function refersh_window() {
			var refersh_time = getCookie('refersh_time');
			if(refersh_time == 1) {
				window.location = "{:U('AdminPost/index',$formget)}";
			}
		}
		setInterval(function() {
			refersh_window();
		}, 2000);
		$(function() {
			setCookie("refersh_time", 0);
			Wind.use('ajaxForm', 'artDialog', 'iframeTools', function() {
				//批量移动
				$('.J_articles_move').click(
					function(e) {
						var str = 0;
						var id = tag = '';
						$("input[name='ids[]']").each(function() {
							if($(this).attr('checked')) {
								str = 1;
								id += tag + $(this).val();
								tag = ',';
							}
						});
						if(str == 0) {
							art.dialog.through({
								id: 'error',
								icon: 'error',
								content: '您没有勾选信息，无法进行操作！',
								cancelVal: '关闭',
								cancel: true
							});
							return false;
						}
						var $this = $(this);
						art.dialog.open(
							"__ROOT__/index.php?g=portal&m=AdminPost&a=move&ids=" +
							id, {
								title: "批量移动",
								width: "80%"
							});
					});
			});
		});

    $("#myModal1").hide();
        $("#myModal4").hide();
		$("#viewOLanguage").chosen();
		$("#viewOLanguage").trigger("liszt:updated");

		$(".ss").click(function() {

			var xuan = $(".mohu option:selected").val();
			var zhi = $(".zhi").val();
			var type = $(".select_3  option:selected").val();
			var typeschool = $(".chzn-select  option:selected").val();
			var isSuccess = 1;
			if(zhi == "") {
				if(xuan != 0) {
					var isSuccess = 0;
					alert("在选好条件在输入框中输入你要找的数据类型");

				}
			}
			if(xuan == 0) {
				if(zhi != "") {
					var isSuccess = 0;
					alert("请选择你要搜索的查询类型")
				}
			}
			if(zhi == "" && xuan == 0) {
				if(type == 0) {
					alert("请选择地区");
					var isSuccess = 0;
				}
				if(typeschool == "") {
					var isSuccess = 0;
					alert("请选择学校");
				}
			}
			if(isSuccess == 0) {
				return false;
			}
		})


    $('.gb').click(function(){
    	// console.log('dsadsa');
        $('.a0').val('');
        $('.a1').val('');
        $('.a2').val('');
        $('.a3').val('');
        $('.a4').val('');
        $('.a0').removeAttr('data-id')
        $('.a1').removeAttr('data-id')
        $('.a2').removeAttr('data-id')
        $('.a3').removeAttr('data-id')
        $('.a4').removeAttr('data-id')
        $('.a_0').val('');
        $('.a_1').val('');
        $('.a_2').val('');
        $('.a_3').val('');
        $('.a_4').val('');

    })

    $('.close').click(function(){

        $('.a0').val('');
        $('.a1').val('');
        $('.a2').val('');
        $('.a3').val('');
        $('.a4').val('');
        $('.a0').removeAttr('data-id')
        $('.a1').removeAttr('data-id')
        $('.a2').removeAttr('data-id')
        $('.a3').removeAttr('data-id')
        $('.a4').removeAttr('data-id')
        $('.a_0').val('');
        $('.a_1').val('');
        $('.a_2').val('');
        $('.a_3').val('');
        $('.a_4').val('');

    	
    })


	</script>
</body>

</html>