<teachertpl file="header"/>
<html>
<head>
<style>
</style>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>信息1</title>
<link rel="stylesheet" href="__ROOT__/statics/simpleboot/css/bootstrap_message.css">
<link href="__ROOT__/statics/simpleboot/css/fileinput_message.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__ROOT__/statics/js/jquery.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="__ROOT__/statics/js/fileinput.js" type="text/javascript"></script>
<script src="__ROOT__/statics/js/fileinput_locale_zh.js" type="text/javascript"></script>
  <script src="__ROOT__/statics/js/laydate.js" type="text/javascript"></script>
   <link rel="stylesheet" href="__ROOT__/statics/js/laydate.css">
   <link rel="stylesheet" href="__ROOT__/statics/js/dahong/laydate.css">

<style type="text/css">
.col-auto { overflow: auto; _zoom: 1;_float: left;}
.col-right { float: right; width: 30%; overflow: hidden; margin-left: 6px; }
.table th, .table td {vertical-align: middle;}
.picList li{margin-bottom: 5px;}
.touchlei{ background-color:#eeeeee;}
	.changecolor{ background-color: #F5F5F5}
      tr .pai {
        background-color: #e2e2e2;
      } 
      a{
  color: #00c1dd
}
div{
  color: black;
}
</style>
</head>
<body>
<div class="">
    <ul id="myTab" class=" nav-tabs" style=" margin-top:30px; height:32px; list-style:none;">
   		<li><a href="{:U('index')}" style="color:#1f1f1f; text-decoration:none; padding:14px 15px;" class="touch">信息群发</a></li>
      <li ><a href="{:U('lists')}" style="color:#1f1f1f; text-decoration:none; padding:13px 15px;">已发信息</a></li>
      <li class="active"><a href="{:U('timing_message')}" style="color:#1f1f1f; text-decoration:none; padding:13px 15px;">定时短信监控</a></li>
   	</ul>
   	<div id="myTabContent" class="tab-content" style=" padding-left:30px; padding-right:30px;">
		<div class="tab-pane fade in active" id="home">
    <br/>
     
 
      <div style=" background-color:rgba(0,0,0,0.7); width:100%; height:100%; position:absolute; display: none" class="student_drop"  >
        <div style=" width:400px; background-color:white; margin-left:auto; margin-right:auto; margin-top:5%; padding:20px; position:relative;">
          
            <div>
              <div style=" border:1px solid #dddddd; border-bottom:none; width:100px; text-align:center; line-height:30px;">发送信息修改</div>
              <div style=" border-bottom:1px solid #dddddd; margin-left:100px;"></div>
            </div>
            <div style=" margin-top:30px; margin-bottom:15px; margin-left:30px;" class="numberic">
            
               <div>
                  <p  class="">发送信息时间:<input type="text" class="laydate-icon send_news" name="option_time" onclick="laydate({istime: true, format: 'YYYY-MM-DD hh:mm:ss'})" placeholder="-输入时间-" style="width:188px; margin-top: 6px;     margin-left: 7px;     height: 24px;"></p>

                  <p  class="">信息内容:</p>
                  <textarea class="message_main" name="" rows="4"></textarea>
                  <input type="hidden"  class="messageid">
                 
                 <br><br>
               
                
              
                 
          

                          <!--     <form  action="{:U('ImpUser')}" method="post" enctype="multipart/form-data"> -->
                           
                            
                              <input type="submit" value="确定" class="btn btn-info ensure">&nbsp;&nbsp;&nbsp;
                              <a class="btn btn-danger drop_close">取消</a>
                                
                              <!-- </form> -->
                  </p>
               </div>
              
            </div>
            <div style=" margin-bottom:10px; margin-left:30px;">
            <span class="Sui"></span> 
            </div>
            <!-- <div style=" margin-bottom:10px; margin-left:30px;">
                      确认卡号：<input type="text" placeholder="卡号长度10位数" style=" margin-top:8px; height:30px;">
                    </div> -->
            <div style=" width:60px; margin-left:auto; margin-right:auto; margin-top:20px;">
            

            </div>
        
          <!--关闭start-->
          <img src="__ROOT__/statics/images/cha.png" style=" position:absolute; top:20px; right:20px; width:15px; height:15px; cursor:pointer;" class="drop_close">
          <!--关闭end-->
        </div>
      </div>







			<form class="form-horizontal J_ajaxForm" action="{:u('MessageInfo/timing_message')}" method="post" style="margin: 0px 0px 5px;">
          <div class="search_type cc mb10">
              <div class="mb10">
               <span class="mr20"><!-- 发送类型：
                      <select class="select_2" name="school">
                          <option value="0">--请选择--</option>
                          <option value="1">全部发送</option>
                          <option value="2">各自发送</option>
                      </select> &nbsp;&nbsp; -->
                      时间：
                      <input type="text" class="sang_Calender" name="begintime" placeholder="-选择时间-" style="width: 180px; height: 30px; border-width: 1px;">  -  <input type="text" class="sang_Calender" name="endtime" placeholder="-选择时间-" style="width: 180px; height: 30px; border-width: 1px;"> &nbsp; &nbsp;
                      关键字：
                      <input type="text" class="select_2" name="search" placeholder="-请输入内容-" style="width: 180px; height: 30px; border-width: 1px;">
                      <input type="submit" value="搜索" class="btn btn-primary" style="margin-left:10px; border-width: 1px; background-color: #26a69a; border-color: #26a69a;">
                      <a class="btn btn-danger" href="{:U('MessageInfo/timing_message')}" style="background-color: #26a69a; border-color: #26a69a;">清空</a>
                      <a class="btn btn-primary del" style="background-color: #26a69a; border-color: #26a69a;" >删除</a>
                      <a class="btn btn-primary pause" style="background-color: #26a69a; border-color: #26a69a;" >暂停</a>
                      <a class="btn btn-primary edit" style="background-color: #26a69a; border-color: #26a69a;"  data-toggle="modal" data-target="#myModal2">修改</a>
                      <a class="btn btn-primary continue" style="background-color: #26a69a; border-color: #26a69a;" >继续</a>
                  </span>
              </div>
          </div>
			</form>
      <form class="J_ajaxForm" action="" method="post">
            <div class="table-responsive">
                      <table class="table table-hover table-bordered table-list" style=" border: none;">
                        <thead>
                          <tr style="background-color:#CCC;">
                            <!--<th><input type="checkbox"> 全选</th>-->
                              <th class="pai" style="text-align: center; border-width: 0.5px;"><input name="checkall" type="checkbox" id="checkall" value="checkbox" onclick="change(document.getElementsByName('ids[]'), this.checked)"/> 全选</th>
                            <th class="pai" style="text-align: center; border-width: 0.5px; border-left: none;">信息内容</th>
                            <!-- <th>列表</th> -->
                            <th class="pai" style="text-align: center; border-width: 0.5px; border-left: none;">优先级</th>
                            <th class="pai" style="text-align: center; border-width: 0.5px; border-left: none;">发送人数</th>
                            <th class="pai" style="text-align: center; border-width: 0.5px; border-left: none;">提交时间</th>
                            <!-- <th>发送类型</th>
                            <th>状态</th> -->
                            <th class="pai" style="text-align: center; border-width: 0.5px; border-left: none;">计划时间</th>
                            <th class="pai" style="text-align: center; border-width: 0.5px; border-left: none;">状态</th>
                          </tr>
                        </thead>
                        <foreach name="list" item="vo">
                        <tr class="changcolor">
                           <td style="text-align: center; background:none; border-top: none;"><input type="checkbox" class="J_check" data-yid="J_check_y" data-xid="J_check_x" name="ids[]" value="{$vo.id}" title="ID:{$vo.id}"></td>
                           <td style="text-align: center; background:none; border-top: none; border-left: none;">{$vo.connent}</td>
                           <td style="text-align: center; background:none; border-top: none; border-left: none;">{$vo.level}</td>
                           <td style="text-align: center; background:none; border-top: none; border-left: none;"><a href="{:U('receive',array('id'=>$vo['contentid']))}" >{$vo.sum}个人</a></td>
                           <td style="text-align: center; background:none; border-top: none; border-left: none;">
                          {$vo.addtimeint|date="Y-m-d H:i:s",###}
                           </td>
                           <td style="text-align: center; background:none; border-top: none; border-left: none;">{$vo.plantimeint|date="Y-m-d H:i:s",###}</td>
                           <td style="text-align: center; background:none; border-top: none; border-left: none;">{$vo.status}</td>
                        </tr>
                        </foreach>
                    </table>
                    <div class="pagination">{$Page}</div>
                  </div>
                </form>
        </div>


	<div class="tab-pane fade" id="ios">
	</div>
   </div>
</div>

<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="js/fileinput.js" type="text/javascript"></script>
<script src="js/fileinput_locale_zh.js" type="text/javascript"></script>

<script type="text/javascript">
$('.edit').click(function(){
    var id = document.getElementsByName('ids[]');
            news = new Array();

            var main = new Array(); 
            var ids = new Array();
                //将所有选中复选框的默认值写入到id数组中
                for (var i = 0; i < id.length; i++) {
                    if (id[i].checked){
                       console.log(id[i].parentNode.nextElementSibling.innerText);
                
                        ids.push(id[i].value);

                        main.push(id[i].parentNode.nextElementSibling.innerText);

                        news.push(id[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.innerText)
                      
                    }
                    // $(this).closest('tr').remove();

                } 
         
           if(ids.length == 0)
           {
            alert("请选择要修改的任务");
            return false;

           }

            if(ids.length > 1)
            {
              alert('您一次只能修改一个任务!');

              return false;
            }else{
              console.log(ids);
              console.log(news);
              $(".send_news").val(news); 
              $(".message_main").text(main);
              $(".messageid").val(ids);
              $(".student_drop").fadeIn(300);
            }

  





})


$(".del").click(function(){

    if (confirm("执行以下操作，需要先将任务暂停，您确定吗？")) {
   
     var id = document.getElementsByName('ids[]');
            for (var i = 0; i < id.length; i++) {

                    if (id[i].checked){
                        ids.push(id[i].value);
                        console.log(id[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.innerText);
                       
                       if(id[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.innerText=='待发送' || id[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.innerText=='正在发送')
                       {
                        alert("有信息未暂停!");
                        return false;
                       }
                    }
                   

               } 


                $.ajax({
                    type:'get',
                    url: "{:U('Teacher/MessageInfo/state')}",
                    dataType:'json',
                    data: {
                        'ids': ids,
                        'type':1,
                        
                    },
                    success:function(data){
                         //console.log(data);
                        if(data.status){
                           alert('删除成功');
                           location.reload();
                        }else{
                            alert('删除失败');
                            location.reload();
                        }
                    },
                    //请求失败
                    error:function(){
                       alert('请求失败')
                    }
                })     
        }

})


$(".ensure").click(function(){

   
         var news = $(".send_news").val();
         console.log(news); 
         var main =  $(".message_main").val();
         console.log(main);
         var id   = $(".messageid").val();
   


               $.ajax({
                    type:'get',
                    url: "{:U('Teacher/MessageInfo/state')}",
                    dataType:'json',
                    data: {
                        'ids': id,
                        'main':main,
                        'news':news,
                        'type':3,
                        
                    },
                    success:function(data){
                         //console.log(data);
                        if(data.status){
                           alert('修改成功');
                           location.reload();
                        }else{
                            alert('修改失败');
                            location.reload();
                        }
                    },
                    //请求失败
                    error:function(){
                       alert('请求失败')
                    }
                })     

})



$(".continue").click(function(){

    var id = document.getElementsByName('ids[]');
      // alert('aaa');
            var ids = new Array();
                //将所有选中复选框的默认值写入到id数组中
                for (var i = 0; i < id.length; i++) {
                    if (id[i].checked){
                        ids.push(id[i].value);
                 

                       if(id[i].parentNode.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.nextElementSibling.innerText=='正在发送')
                       {
                        alert("有信息正在发送!");
                        return false;
                       } 
                      
                    }
                    // $(this).closest('tr').remove();

               } 
                $.ajax({
                    type:'post',
                    url: "{:U('Teacher/MessageInfo/state')}",
                    dataType:'json',
                    data: {
                        'ids': ids,
                        'type':4,
                        
                    },
                    success:function(data){
                         //console.log(data);
                        if(data.status){
                           alert('继续成功');
                           location.reload();
                        }else{
                            alert('继续失败');
                            location.reload();
                        }
                    },
                    //请求失败
                    error:function(){
                       alert('请求失败')
                    }
                }) 



})

      $(".drop_close").click(function() {

          $(".student_drop").hide()
        }

   )

 
 //暂停
  $('.pause').click(function(){
       var id = document.getElementsByName('ids[]');
      // alert('aaa');
            var ids = new Array();
                //将所有选中复选框的默认值写入到id数组中
                for (var i = 0; i < id.length; i++) {
                    if (id[i].checked){
                        ids.push(id[i].value);
                      
                    }
                    // $(this).closest('tr').remove();

                } 

              
              
                if(ids.length == 0)
                {
                  alert("请勾选要暂停的记录");
                  return false;
                }

                  $.ajax({
                    type:'post',
                    url: "{:U('Teacher/MessageInfo/state')}",
                    dataType:'json',
                    data: {
                        'ids': ids,
                        'type':2,
                        
                    },
                    success:function(data){
                         //console.log(data);
                        if(data.status){
                           alert('暂停成功');
                           location.reload();
                        }else{
                            alert('暂停失败');
                            location.reload();
                        }
                    },
                    //请求失败
                    error:function(){
                       alert('请求失败')
                    }
                })     
          
    


})


</script>

<script>
$('#myTab a:first').tab('show');



</script>
<script>
		// $("#file-3").fileinput({
		// 	showUpload: false,
		// 	showCaption: false,
		// 	browseClass: "btn btn-default",
		// 	fileType: "any",
	 //        previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
		// });
	 //    $(document).ready(function() {
	 //        $("#test-upload").fileinput({
	 //            'showPreview' : false,
	 //            'allowedFileExtensions' : ['jpg', 'png','gif'],
	 //            'elErrorContainer': '#errorBlock'
	 //        });

	 //    });
		</script>
    <script>
   $(function () {
      $('#myTab li:eq(0) a').tab('show');
   });
</script>
<script>
            $("#file-3").fileinput({
                  showUpload: false,
                  showCaption: false,
                  browseClass: "btn btn-default",
                  fileType: "any",
              previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
            });
          $(document).ready(function() {
              $("#test-upload").fileinput({
                  'showPreview' : false,
                  'allowedFileExtensions' : ['jpg', 'png','gif'],
                  'elErrorContainer': '#errorBlock'
              });

          });
            </script>
                        <script>
            $(".touch").mouseenter(
					function(){
						$(".touch").addClass("touchlei")
						}
			)
			 $(".touch").mouseleave(
					function(){
						$(".touch").removeClass("touchlei")
						}
			)
            </script>


            <!--全选 start-->
            <script>
            var change = function(chkArray,val){
                for(var i=0;i<chkArray.length;i++){
                // 遍历指定组中的所有项
                    chkArray[i].checked = val;
                //设置项为指定的值  是否选中
                }
            }
            </script>
            <!-- 全选 end-->

</body>
</html>
