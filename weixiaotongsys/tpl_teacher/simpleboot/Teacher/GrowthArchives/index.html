<teachertpl file="header" />
<html>

	<head>
		<style>

		</style>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<title>信息</title>
		<link href="__ROOT__/statics/simpleboot/css/fileinput_message.css" media="all" rel="stylesheet" type="text/css" />
		<link href="__ROOT__/statics/js/artDialog/skins/default.css" rel="stylesheet" />
		<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
		<script src="__ROOT__/statics/js/fileinput.js" type="text/javascript"></script>
		<script src="__ROOT__/statics/js/fileinput_locale_zh.js" type="text/javascript"></script>
		<script src="__ROOT__/statics/js/wind.js"></script>
		<style type="text/css">
			.col-auto {
				overflow: auto;
				_zoom: 1;
				_float: left;
			}
			
			.col-right {
				float: right;
				width: 30%;
				overflow: hidden;
				margin-left: 6px;
			}
			
			.table th,
			.table td {
				vertical-align: middle;
			}
			
			.picList li {
				margin-bottom: 5px;
			}
			
			.touchlei {
				background-color: #eeeeee;
			}
			
			tr .pai,
			tr .pai2 {
				text-align: center;
				font-size: 14px;
			}
			
			tr .pai {
				background-color: #e2e2e2;
			}
			
			tr .pai2 {}
			
			.clearfix {
				clear: both;
			}
			
			.name {
				margin-right: 10px;
			}
			
			.dbzr {
				background-color: #61c881;
				color: white;
				text-align: center;
				padding: 0px 15px;
				float: left;
				border-radius: 8px;
			}
			
			.sic {
				width: 15px;
				margin-left: 5px;
				margin-top: -15px;
				cursor: pointer;
			}
			
			.daiban {
				border-bottom: 1px solid #dddddd;
			}
			
			.daike {
				width: 100px;
				text-align: center;
				line-height: 30px;
				float: left;
				border-bottom: 1px solid #dddddd;
			}
			
			.dailei {
				border: 1px solid #dddddd;
				border-bottom: none;
				font-weight: bold;
			}
			
			.banji {
				float: left;
				width: 20%;
				margin-bottom: 10px;
			}
			
			.banji input {
				margin-top: -2px;
				margin-right: 5px;
			}
			
			.subject {
				float: left;
				color: #03a9f4;
				margin-right: 15px;
				cursor: pointer;
			}
			
			.peizhi {
				color: #03a9f4;
			}
			
			.kecheng {
				color: #03a9f4;
				float: left;
				display: none;
				border: 1px solid #03a9f4;
				padding-left: 3px;
				padding-right: 3px;
				cursor: pointer;
			}
			
			.subinput {
				display: none;
			}
			select{
				color: #000;
			}
		</style>
		<script>
			window.onload = function() {
				var sb = document.getElementById("tans");
				sb.onclick = function() {
					var tanboder = document.getElementById("tansboder");
				}
			}
		</script>
	</head>

	<body>

	<!-- 模态框（Modal） -->
	<input  type="hidden" value="{$schoolid}" id="schoolid" />
	<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header" style="background: white">
					<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					<h5 class="modal-title" id="myModalLabel" style="color: black; font-weight:bold;">设置档案</h5>
					<hr>
				</div>
				<span style="margin-left:3%">以启用年级</span>
				<div class="modal-body1" style="height:100px;">
						<div class="yes">
						<!--<label style="float:left;padding:15px;"><input name="Fruit" type="checkbox" value="" />苹果 </label>-->
						<!--<label style="float:left;padding:15px;"><input name="Fruit" type="checkbox" value="" />桃子 </label>-->
						<!--<label style="float:left;padding:15px;"><input name="Fruit" type="checkbox" value="" />香蕉 </label>-->
						<!--<label style="float:left;padding:15px;"><input name="Fruit" type="checkbox" value="" />梨 </label>-->
					</div>
				</div>
				<span style="margin-left:3%">未启用年级</span>
				<div class="modal-body2" style="height:100px;">
					<input name="text" type="hidden" id="archivesid" value="" />
					<div class="no">
					</div>
				</div>
				<div class="modal-footer">
					<!--<button type="button" class="btn btn-default" data-dismiss="modal" style="background: white; color:black; font-weight:bold;">关闭</button>-->
					<button  id="sub" style="width:80px;height:40px;background: white; color:black; font-weight:bold;" >提交</button>
					<!--//class="btn btn-info pwdtj"-->
				</div>

			</div>
		</div>
	</div>
	<!-- 模态框（Modal） -->
	<div class="modal fade" id="myModa4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header" style="background-color: white;">
					<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>

					<div style=" cursor: pointer;">
						<ul class=" nav-tabs" style=" margin-top:30px; height:30px; list-style:none;">
							<li class="active " id="aniu">
								<a style="color:#1f1f1f; text-decoration:none; padding:10px 15px;">书页选择</a>
							</li>
						</ul>
					</div>
				</div>
				<input name="text" type="hidden" id="pagearchives" value="" />
				<input name="text" type="hidden" id="gradeid" value="" />
				<input name="text" type="hidden" id="archivesgradeid" value="" />
				<div class="modal-body5" style="padding-bottom: 10px;">
					<div class="hideid">
						<div id="qqq">
							<span style="margin-left: 3%;">年级:</span>
						</div>
						<span style=" float:left;margin-left: 3%;">书页:</span><br>
						<div style="overflow-y:scroll; padding:10px;margin-top:10px;border: 1px solid gainsboro;" class="page_info">

								<!--<div class="banji" style=" float:left; width:20%; margin-bottom:10px;cursor:pointer;">-->
									<!--<input type="checkbox" name="class_else"  value="3">-->
									<!--<span class="manid">345</span>-->
								<!--</div>-->
							<div id="noselect">

							</div>
								<!--<div class="banji" style=" float:left; width:20%; margin-bottom:10px;cursor:pointer;">-->
									<!--<input type="checkbox" name="class_else"  value="3">-->
									<!--<span class="manid">345</span>-->
								<!--</div>-->
							<div class="clearfix"></div>
						</div>
					</div>

				</div>
				<div class="modal-footer">
					<button type="button" id="pagesubmit" style="width:80px;height:40px;background: white; color:black; font-weight:bold;" >提交更新</button>
					<!--<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>-->
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal -->
	</div>
	<div class="wrap jj">
			<ul id="myTab" class="nav-tabs" style=" margin-top:30px; height:30px; list-style:none;">
				<li class="active">
					<a href="{:U('index')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;">成长档案设置</a>
				</li>

				<li>
					<a href="{:U('add')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;" class="touch">添加</a>
				</li>
			</ul>

			<div id="myTabContent" class="tab-content" style=" padding-left:30px; padding-right:30px;">
				<div class="tab-pane fade in active" id="home">
					<br/>
					<form class="form-horizontal J_ajaxForm" action="{:u('index')}" method="get">
						<div class="search_type cc mb10">
							<div class="mb10">
								<span class="mr20">
					 学校名称:
                      <input type="text" class="select_2" name="schoolname" placeholder="-请输入-" style="width:8%; height: 17px;border-width:1px;color: black;" value="{$school_name}"> &nbsp;&nbsp;
					档案名称:
                      <input type="text" class="select_2" name="filename" placeholder="-请输入-" style="width:8%; height: 17px;border-width:1px;color: black;" value="{$filename}"> &nbsp;&nbsp;
                      学期:
                      <select class="select_2" name="semester" style="width:9%; height: 30px">
                        <option value='0'>请选择</option>
                        <foreach name="semester" item="vo">
                            <php>$semester=$semester1==$vo['semester']?"selected":"";</php>
                            <OPTION value="{$vo.semester}" {$semester}>{$vo.semester}</OPTION>
                        </foreach>
                      </select> &nbsp;&nbsp;
                      <input type="submit" style="border:none; background-color:#26a69a; color:white; border-radius:5px; padding:5px 10px 5px 10px;" value="搜索" />
                  </span>
							</div>
						</div>
					</form>

					<form class="J_ajaxForm" action="" method="post">
						<div class="table-responsive">
							<table class="table table-hover table-bordered table-list">
								<thead>
									<tr style="background-color:#CCC;">
										<th class="pai" style=" border-left: none;border-width: 0.5px;">学校名称</th>
										<th class="pai" style=" border-left: none;border-width: 0.5px;">档案名称</th>
										<th class="pai" style=" border-left: none;border-width: 0.5px;">学期</th>
										<th class="pai" style=" border-left: none;border-width: 0.5px;">学期开始时间</th>
										<th class="pai" style=" border-left: none;border-width: 0.5px;">学期结束时间</th>
										<th class="pai" style=" border-left: none;border-width: 0.5px;border-right: none">操作</th>
										<th class="pai" style=" border-left: none;border-width: 0.5px;border-right: none">档案进展</th>
									</tr>
								</thead>
								<foreach name="archives" item="vo">
									<tr>
										<td class="pai2">{$vo.school_name}</td>
										<td class="pai2">{$vo.name}</td>
										<td class="pai2 stuname">{$vo.semester}</td>
										<td class="pai2 stuid" name="card">{$vo.semester_start}</td>
										<td class="pai2">{$vo.semester_end}</td>
										<td class="pai2">
											<a href="{:U('delete',array('id'=>$vo['id']))}" class="J_ajax_del" style=" color:#00c1dd;">
												<if condition="$vo['stu_count'] neq 0">
													<elseif condition="$vo['stu_count'] eq 0" /> 删除
												</if>
											</a>
											<a href="{:U('change',array('id'=>$vo['id']))}" style=" color:#00c1dd;">
												 修改
											</a>

											<!--<a href="" style=" color:#00c1dd;">-->
												<!--启用-->
											<button class="btn"   data-toggle="modal" value="{$vo['id']}" data-target="#myModal" style="font-size: 14px;vertical-align: 1px;background-color: transparent;color: #00c1dd;">启用</button>

											<!--模板选择-->
											<button class="page" data-toggle="modal" value="{$vo['id']}" data-target="#myModa4" style=" font-size: 14px;vertical-align: 0.5px;border:none;background-color: transparent;color: #00c1dd;">书页</button>


										</td>
										<td class="pai2"><a href="{:U('show',array('id'=>$vo['id']))}" style=" color:#00c1dd;">查看</a></td>

									</tr>
								</foreach>
							</table>

							
						</div>
					</form>


						<input class="uisid" type="hidden" />
				
				</div>
			</div>
			<div class="tab-pane fade" id="ios">

			</div>
	        <div class="pager">{$Page}</div>
			
		</div>
		<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
		<script src="__ROOT__/statics/js/common.js"></script>
		<script type="text/javascript">
			//全局变量
			var GV = {
				DIMAUB: "/",
				JS_ROOT: "statics/js/",
				TOKEN: ""
			};
		</script>

		<script>
			$("#myModal").hide();
            $("#myModa3").hide();
			//启用
			$(".btn").click(function(){
			    $('.modal-body1').find(".yes").remove();
			    $('.modal-body2').find(".no").remove();
			    var schoolid = $("#schoolid").val();//学校ID
				var id = $(this).val();
				if(id){
				    $('#archivesid').val(id);
				}
                $.ajax({
                    type: "get",
                    url: "{:U('Teacher/GrowthArchives/gradeList')}",
                    dataType: 'json',
                    data: {
                        schoolid: schoolid,
                        archivesid:id
                    },
                    success: function(res) {
                        var htmls = "";
                        var html = "";
                        arr = eval(res.data.selected);//已选择的年级
                        console.log(arr);
                        if(typeof(arr) !=="undefined"){
                            for (var i = 0; i < arr.length; i++) {
                                var gradename = arr[i].name; //年级名称
                                var gradeid = arr[i].gradeid; //年级ID
                                htmls+='<div class="yes">'
                                htmls+=' <label style="float:left;padding:15px;"><input name="select" style="margin:0 0 0;" checked="checked" disabled="disabled" type="checkbox" value="'+gradeid+'" />'+ gradename+'</label>';
                                htmls+='</div>'
                            }
                            $(".modal-body1").append(htmls);
						}

                        result = eval(res.data.notselected);//未选择的年级
                        if(typeof(result) !=="undefined"){
                            for (var i = 0; i < result.length; i++) {
                                var gradename = result[i].name; //年级名称
                                var gradeid = result[i].gradeid; //年级ID
                                html+='<div class="no">'
                                html+=' <label style="float:left;padding:15px;"><input name="test" style="margin:0 0 0;" type="checkbox" value="'+gradeid+'" />'+ gradename+'</label>';
                                html+='</div>'
                            }
                            $(".modal-body2").append(html);
						}


                    },
                    error: function() {
                        alert('系统错误,请稍后重试');
                    }
                });
			});
			//启用提交
			$("#sub").click(function(){
			    var archivesid=$("#archivesid").val();
                var obj=document.getElementsByName('test');
                var sid="";
                for(var i=0; i<obj.length; i++){
                    if(obj[i].checked){
                        sid+=obj[i].value+',';
					}
                }
				if(sid==""){
				    alert("请勾选年级");
				    return;
				}
                  $.ajax({
                      type: "post",
                      url: "{:U('Teacher/GrowthArchives/archives_grade')}",
                      async: true,
                      dataType: 'json',
                      data: {
                          gradeid:sid,
                          archivesid:archivesid
                      },
                      success: function(res){
                          alert("启用成功");
                          history.go(0);
                      },
                      error: function() {
                          alert('系统错误,请稍后重试');
                      }
                  });
            });
			//书页
            $(".page").click(function(){
                $('.page_info').html("");
                $('.search_grade').remove();
                var schoolid = $("#schoolid").val();//学校ID
                var archivesid = $(this).val();//档案ID
                if(archivesid){
                    $('#pagearchives').val(archivesid);
                }
                $.ajax({
                    type: "get",
                    url: "{:U('Teacher/GrowthArchives/selectedGrade')}",
                    dataType: 'json',
                    data: {
                        schoolid:schoolid,
                        archivesid:archivesid
                    },
                    success: function(res){
                        console.log(res);
						if(res.data==0){
                            alert(res.message);
                            history.go(0);
                    }
                       result = eval(res.data);//拉取已启用的年级
						var html="";
                        html+='<select class="search_grade" name="search_grade" >';
						html+='<option value="0">'+'--请选择--'+'</option>';
                            for (var i = 0; i < result.length; i++) {
                             	var gradename = result[i].name; //年级名称
                                var gradeid = result[i].gradeid; //年级ID
                                var archivesgradeid = result[i].id; //档案年级id
								html+='<option class="grade_info" id="'+archivesgradeid+'" value="'+gradeid+'">'+gradename+'</option>'
                            }
                        html+='</select>';
                        $("#qqq").append(html);

                    },
                    error: function() {
                        alert('系统错误,请稍后重试');
                    }
                });
            });
            //书页列表
            $(document).on('change', '.search_grade', function(){
                var id = $(this).val();//年级ID
                if(id){
                    $('#gradeid').val(id);
                }
                var archivesgradeid = $(this).find("option:selected").attr('id');//档案年级ID
				if(archivesgradeid){
                    $('#archivesgradeid').val(archivesgradeid);
				}
                var archivesid=$("#pagearchives").val();//档案ID
                $('.page_info').html("");
				$.ajax({
				    type:"get",
                    url: "{:U('Teacher/GrowthArchives/pageList')}",
                    dataType: 'json',
                    data:{
                        archivesid:archivesid,
                        gradeid:id
                    },
                    success: function(result){
                         var html="";
                         var htmls="";
                         var arr = result.data.selected;//已选的页码
                        if(typeof(arr) !=="undefined") {
                            html+='<div style=" width: 100%;height:auto;float: left">'
                            html+='<span style=" float:left;margin-left: 2%;">'+'已选书页:'+'</span><br>'
                            for (var i = 0; i < arr.length; i++) {
                                var pagename = arr[i].name; //书页名称
                                var pageid = arr[i].id; //书页ID
                                html += ' <div class="banji" style=" float:left; width:20%; margin-bottom:10px;cursor:pointer;">';
                                html += ' <input type="checkbox"  value="' + pageid + '" disabled="disabled"   checked>';
                                html += ' <span class="manid">' + pagename + '</span>';
                                html += '</div>';

                            }
                            html += '</div>';
                        }
                        $(".page_info").append(html);
                        var res = result.data.notselected;//未选的页码
                        if(typeof(res) !=="undefined") {
                            htmls+='<div style="float: left;width: 100%">'
                            htmls+='<span style=" float:left;margin-left: 2%;">'+'未选书页:'+'</span><br>'
                            for (var i = 0; i < res.length; i++) {
                                var pagename = res[i].name; //书页名称
                                var pageid = res[i].id; //书页ID
                                var status = res[i].default; //是否选中
                                htmls += ' <div class="banji" style=" float:left; width:20%; margin-bottom:10px;cursor:pointer;">';
                                if(status==1){
                                    htmls+=' <input type="checkbox" name="page_else"  value="'+pageid+'" disabled="disabled"   checked>';
								}else{
                                    htmls+=' <input type="checkbox" name="page_else"  value="'+pageid+'">';
								}
                                htmls += ' <span class="manid">' + pagename + '</span>';
                                htmls += '</div>';

                            }
                            htmls+='</div>'
                        }
                        $(".page_info").append(htmls);

                    },
                    error: function() {
                        alert('系统错误,请稍后重试');
                    }

				})
            });
			$('#pagesubmit').click(function(){
                var archivesid=$("#pagearchives").val();//档案ID
                var gradeid=$("#gradeid").val();//年级ID
                var archivesgradeid=$("#archivesgradeid").val();//档案年级ID
				if(gradeid==""){
                    alert("请选择年级");
                    return;
				}
                var obj=document.getElementsByName('page_else');
                var pageid="";
                for(var i=0; i<obj.length; i++){
                    if(obj[i].checked){
                        pageid+=obj[i].value+',';  //如果选中，将value添加到变量s中
                    }
                }
                if( pageid==""){
                    alert("请勾选书页");
                    return;
                }
                $.ajax({
                    type: "post",
                    url: "{:U('Teacher/GrowthArchives/addBook')}",
                    dataType: 'json',
                    data: {
                        pageid:pageid,//书页ID
                        archivesid:archivesid,//档案ID
                        gradeid:gradeid,//年级ID
                        archivesgradeid:archivesgradeid//档案年级ID
                    },
                    success: function(res){
                        if(res.data==0){
                            alert(res.message);
						}else{
                            alert("提交成功");
                            history.go(0);
						}
                    },
                    error: function() {
                        alert('系统错误,请稍后重试');
                    }
                });
			});

            $("#submit").click(function(){
                var archivesid=$("#tem").val();
                var obj=document.getElementsByName('template');
                var templateid="";
                for(var i=0; i<obj.length; i++){
                    if(obj[i].checked){
                        templateid+=obj[i].value+',';  //如果选中，将value添加到变量s中
                    }
                }
                if(templateid==""){
                    alert("请勾选模板");
                    return;
                }

                $.ajax({
                    type: "post",
                    url: "{:U('Teacher/GrowthArchives/template_relation')}",
                    async: true,
                    dataType: 'json',
                    data: {
                        templateid:templateid,
                        archivesid:archivesid
                    },
                    success: function(res) {
                        alert("添加成功");
                        history.go(0);
                    },
                    error: function() {
                        alert('系统错误,请稍后重试');
                    }
                });
            });
		</script>
		<script>
			$('#myTab a:first').tab('show');
		</script>
		<script>
			$("#file-3").fileinput({
				showUpload: false,
				showCaption: false,
				browseClass: "btn btn-default",
				fileType: "any",
				previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
			});
			$(document).ready(function() {
				$("#test-upload").fileinput({
					'showPreview': false,
					'allowedFileExtensions': ['jpg', 'png', 'gif'],
					'elErrorContainer': '#errorBlock'
				});
			});
		</script>
		<script>
			$(function() {
				$('#myTab li:eq(0) a').tab('show');
			});
		</script>
		<script>
			$("#file-3").fileinput({
				showUpload: false,
				showCaption: false,
				browseClass: "btn btn-default",
				fileType: "any",
				previewFileIcon: "<i class='glyphicon glyphicon-king'></i>"
			});
			$(document).ready(function() {
				$("#test-upload").fileinput({
					'showPreview': false,
					'allowedFileExtensions': ['jpg', 'png', 'gif'],
					'elErrorContainer': '#errorBlock'
				});
			});
		</script>
		<script>
			$(".touch").mouseenter(
				function() {
					$(".touch").addClass("touchlei")
				}
			)
			$(".touch").mouseleave(
				function() {
					$(".touch").removeClass("touchlei")
				}
			)
		</script>
		<script>
			$(".banzhuren").click(
				function() {
					$(".bantan").show()
				}
			)
			$(".banzhuren").click(
				function() {
					aaa = $(this).text()
					$(".bzr").text(aaa)
				}
			)
			$(".xuan").click(
				function() {
					k = $(this).parent().text()
					$(".bzr").text(k)
				}
			)
		</script>
		<script>
			$(".guan").click(
				function() {
					$(".bantan").hide()
				}

			)
		</script>

		<script>
			$(".xiala").click(
				function() {
					$(".shou01").slideToggle()
					$(".xshang").toggle()
					$(".bianzi").toggle()
				}

			)
		</script>


	</body>

</html>