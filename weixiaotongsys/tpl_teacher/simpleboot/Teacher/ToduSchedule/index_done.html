<teachertpl file="header"/>
 <script src="__ROOT__/statics/js/layer/layer.js" type="text/javascript"></script>
<style type="text/css">
	.touchlei{ background-color:#eeeeee;}
</style>
<style type="text/css">
.col-auto { overflow: auto; _zoom: 1;_float: left;}
.col-right { float: right; width: 30%; overflow: hidden; margin-left: 6px; }
.table th, .table td {vertical-align: middle;}
.picList li{margin-bottom: 5px;}
  .main td{ text-align: center;}
            .modal.fade.in {
      top: 2%;
          }
                      tr .pai {
        background-color: #e2e2e2;
         text-align: center;
      }

            tr .pai2 {
        text-align: center;
        font-size: 14px;
        color: black;
      }
</style>
<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="js/fileinput.js" type="text/javascript"></script>
<script src="js/fileinput_locale_zh.js" type="text/javascript"></script>
<script src="__ROOT__/statics/js/common.js"></script>

<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> 
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="js/fileinput.js" type="text/javascript"></script>
<script src="js/fileinput_locale_zh.js" type="text/javascript"></script>
<!-- <link rel="stylesheet" href="__ROOT__/statics/simpleboot/css/bootstrap_message.css"> -->
<link href="__ROOT__/statics/simpleboot/css/fileinput_message.css" media="all" rel="stylesheet" type="text/css" />
<script type="text/javascript" src="__ROOT__/statics/js/jquery.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/bootstrap.min.js"></script>
<script type="text/javascript" src="__ROOT__/statics/js/datetime.js"></script>
<script src="__ROOT__/statics/js/fileinput.js" type="text/javascript"></script>
<script src="__ROOT__/statics/js/fileinput_locale_zh.js" type="text/javascript"></script>
<script src="__ROOT__/statics/js/common.js"></script>

<body>
      <ul id="myTab" class="nav-tabs" style=" margin-top:30px; height:30px; list-style:none;">
            <li ><a href="{:U('index_todo')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;">待办工作</a></li>
            <li class="active"><a href="{:U('index_done')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;" class="touch">已办工作</a></li>
            <li><a href="{:U('index_find')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;" class="touch">工作查询</a></li>
            <li><a href="{:U('add')}" style="color:#1f1f1f; text-decoration:none; padding:10px 15px;" class="touch">新建工作</a></li>
      </ul>

 <div style="margin-left: 25px;margin-right: 20px;">
           <!-- 办理流程图 -->

        <div class="modal fade" id="myModal1" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none; ">
                      <div class="modal-dialog" style="    margin-top: 0;">
                        <div class="modal-content">
                          <div class="modal-header" style="background: white">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close" style="position: relative;
    left: -12px;"><span aria-hidden="true">&times;</span></button>
                            <h5 class="modal-title" id="myModalLabel" style="color: black; font-weight:bold;"><span class="stuname"></span>班学生信息</h5>
                            <hr>
                          </div>
                          <div class="modal-body2" style="max-height: 300px; overflow-y: auto;">
                             <div class="table-responsive main">
                             <h3 class="bt" style="text-align: center; color: red;"></h3>
             
                   
                
        
                  </div>
    
                            
                          </div>
                          <div class="modal-footer">
                            <button type="button" class="btn btn-default" data-dismiss="modal" style="background: white; color:black; font-weight:bold;">关闭</button>
                           
                          </div>
                       
                        </div>
                      </div>
         </div>   



    <form class="js-ajax-form" action="" method="post" action="{:U('ToduSchedule/index_todo')}">
      <table class="table table-hover table-bordered table-list">
        <thead>
          <tr style="background-color:#CCC;">
            <th class="pai">发出工作id</th>
            <th class="pai">发出工作</th>
            <th class="pai">发起人</th>
            <th class="pai">发起内容</th>
            <th class="pai">当前步骤</th>
            <!-- <th>上一步经办人</th> -->
            <th class="pai">流程开始时间</th>
            <th class="pai">状态</th>
            <th class="pai">操作</th>
          </tr>
        </thead>
        <foreach name="lists" item="vo">
        <tr>
          <td class="pai2">{$vo.scheduleid}</td>
          <td class="pai2">{$vo.title}</td>
          <td class="pai2">{$vo.one_name}</td>
          <td class="pai2">{$vo.content}</td>
          <td class="pai2">{$vo.step}</td>
          <!-- <td>唐老师</td> -->
          <td class="pai2">{$vo.create_time|date="Y-m-d H:i:s",###}</td>
          <td class="pai2">
              <if condition="$vo['status'] == 0"> 
                   进行中
                  <elseif condition="$vo['status'] == 1"/>
                   已完成
              </if>
          </td>
          <td class="pai2">
              <a class="show_t" style="cursor: pointer;color: #00c1dd;" data-toggle="modal"  data-id="{$vo.scheduleid}" data-st="{$vo['status']}" >办理流程图</a>
          </td>


        </tr>
        </foreach>
      </table>
      <div class="pagination">{$Page}</div>
    </form>
  </div>




</body>
</html>

<script>
   $('.show_t').click(function(){

         var type = $(this).attr('data-st');
 

layer.load();
  var sum = screen.width+screen.height;
  if(sum<'2240')
   {
    $(".main").css("height",'200px');

   }
 var  id = $(this).attr('data-id');
  console.log(id);

  var obj =$('body').find('.main');

  var ss = $('body').find('.ss');
  show_tAjax(id,obj,ss);

  //var ss = $('body').find('.ss');
 //console.log(ss);
   // ss.remove()
})

function show_tAjax(id,obj,ss)
{
  
     $.ajax({
                type:'get',
                url: "{:U('Teacher/ToduSchedule/show_t')}",
                dataType:'json',
                data: {
                  'id': id,           
               },
                success:function(data){
                     setTimeout(function(){
                      layer.closeAll('loading');
                    });
                         $("#myModal1").modal("show")  
                      //console.log(data);
                     // console.log(cbj);
                    // console.log(data.msg.length);
                    if(data.status){
                    ss.remove()
                     for(var i = 0; i < data['msg'].length; i++){
                      // if(data['msg'][i]['arrivetime']== undefined )
                      // {
                      //   data['msg'][i]['arrivetime']='';
                      // }
                      // if(data['msg'][i]['card']==null)
                      // {
                      //   data['msg'][i]['card']='';
                      // }
                        if(data['msg'][i]["step"]=='第1步')
                        {
                          obj.append("<table class='table ss'  table-hover table-bordered table-list border=1  style='margin: 0 auto;width: 500px; margin-bottom:10px;'> <thead><tr style=margin-bottom:10px;><td colspan=4>"+data['msg'][i]['step']+"<em style='font-style:normal; color:red'>["+data['msg'][i]['status']+"]<em></td><tr><tr><td width=20%>办理者</td><td>"+data['msg'][i]["name"]+"</td></tr><tr> <td width=20%>工作内容</td><td colspan=3>"+data['msg'][i]["feedback"]+"</td></tr><tr> <td >创建时间</td><td>"+data['msg'][i]["create_time"]+"</td></tr> </thead></table>")
                        }else{

                        obj.append("<table class='table ss' table-hover table-bordered table-list border=1 style='margin: 0 auto;width: 500px; margin-bottom:10px;'> <thead><tr style=margin-bottom:10px;><td colspan=4>"+data['msg'][i]['step']+"<em style='font-style:normal; color:red'>["+data['msg'][i]['status']+"]<em></td><tr><tr><td width=20%>办理者</td><td colspan=3>"+data['msg'][i]["name"]+"</td></tr><tr> <td width=20%>办理意见</td><td colspan=3>"+data['msg'][i]["feedback"]+"</td></tr><tr> <td >接收时间</td><td>"+data['msg'][i]["read_time"]+"</td><td>完成时间</td><td>"+data['msg'][i]['do_time']+"</td></tr> </thead></table>")
                          }
                     }
                    }else{
                        alert('数据有误');
                    }
                },
                //请求失败
                error:function(){
                   alert('请求失败')
                }
            })


}


</script>