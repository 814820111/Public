<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>{$schoolname}</title>
    <link rel="stylesheet" href="__TMPL__public/css/zaixianQingjia.css">
    <link rel="stylesheet" href="__TMPL__public/css/top-box.css">
    <link rel="stylesheet" href="__TMPL__public/bootstrap/css/bootstrap.min.css" />
    <!--<script src="http://apps.bdimg.com/libs/jquery/2.1.4/jquery.js"></script>-->
    <script src="__ROOT__/statics/wjs/jquery-3.0.0.min.js"></script>
    <script type="text/javascript" src="__TMPL__public/bootstrap/js/bootstrap.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport" />
    <link href="__TMPL__public/css/mobiscroll.css" rel="stylesheet" type="text/css">
    <script src="__TMPL__public/js/mobiscrolsddsl.js" type="text/javascript"></script>
    <script src="http://apps.bdimg.com/libs/zepto/1.1.4/zepto.min.js"></script>
    <script src="http://res.wx.qq.com/open/js/jweixin-1.2.0.js"></script>


    <style>
        #submit {
            width: 25%;
            height: 35px;
            border-radius: 10px;
            border: none;
            background-color: #06c18e;
            color: white;
            margin-top: 25px;
            margin-left: 20%;
        }
        #end {
            width:25%;
            height: 35px;
            border-radius: 10px;
            border: none;
            background-color: rgb(255,184,73);
            color: white;
            /*margin-top: 25px;*/
            margin-right:20%;
        }
        
        .kang {
            margin-top: 5px;
            width: 35px;
            height: 35px;
            border-radius: 35px;
            position: relative;
            bottom: 3px;
        }
        
        #previewImage {
            width: 100%;
        }
        
        #previewImage div {
            float: left;
            width: 20%;
            margin-left: 4%;
        }
        
        #previewImage div img {
            width: 100%;
            margin-bottom: 10px;
            height: calc(height);
        }
        
        .a-upload {
            height: 72px;
            width: 72px;
            float: left;
            position: relative;
            cursor: pointer;
            background: url(__TMPL__public/img/z_add.png) no-repeat center center;
            border: 1px solid #adadad;
            margin-top: -1px;
            margin-left: 10px;
            margin-bottom: 10px;
        }
        
        .a-upload input {
            top: 0;
            left: 0;
            width: 72px;
            ;
            height: 72px;
            opacity: 0;
            cursor: pointer;
        }
        
        #chooseImage {
            top: 0;
            left: 0;
            width: 72px;
            height: 72px;
            opacity: 0;
            cursor: pointer;
        }
        
        * {
            padding: 0px;
            margin: 0px;
        }
        
        .content {
            width: 100%;
            height: 0px;
            background: #F27729;
            position: absolute;
            top: 40px;
        }
        
        .content .select {
            width: 100%;
            height: 40px;
            background: #FFFFFF;
            margin: 0px auto;
            position: relative;
            cursor: pointer;
        }
        
        .content .select::after {
            content: "";
            display: block;
            width: 10px;
            height: 10px;
            border-left: 1px solid #D0D0D0;
            border-bottom: 1px solid #D0D0D0;
            top: 12px;
            right: 12px;
            position: absolute;
            transform: rotate(-46deg);
            transition: all .3s ease-in;
        }
        
        .content .select p {
            width: 100%;
            line-height: 40px;
            font-size: 15px;
            font-family: "microsoft yahei";
            color: #666666;
            padding: 0px 8px;
        }
        
        .content .select ul {
            width: 100%;
            display: block;
            font-size: 16px;
            background: #FFFFFF;
            position: absolute;
            top: 30px;
            left: 0px;
            max-height: 0px;
            overflow: hidden;
            transition: max-height .3s ease-in;
        }
        
        .content .select ul li {
            width: 100%;
            height: 40px;
            line-height: 30px;
            padding: 0px 15px;
            list-style: none;
            color: #666666;
            border-bottom: 2px solid gainsboro;
        }
        
        .content .select ul li.Selected {
            background: yellowgreen;
            color: #FFFFFF;
        }
        
        .content .select ul li:hover {
            background: #D0D0D0;
        }
        
        @-webkit-keyframes slide-down {
            0% {
                transform: scale(1, 0);
            }
            25% {
                transform: scale(1, 1.2);
            }
            50% {
                transform: scale(1, 0.85);
            }
            75% {
                transform: scale(1, 1.05);
            }
            100% {
                transform: scale(1, 1);
            }
        }
        
        .content .select.open ul {
            max-height: 250px;
            transform-origin: 50% 0;
            -webkit-animation: slide-down .5s ease-in;
            transition: max-height .2s ease-in;
        }
        
        .content .select.open::after {
            transform: rotate(134deg);
            transition: all .3s ease-in;
            top: 18px;
        }
        
        .top_bo {
            background-color: #06c18e;
            font-size: 15px;
            font-family: "微软雅黑 Light";
            font-weight: 600;
            line-height: 38px;
            color: white;
            text-align: center;
        }
        
        .top_bo img {
            width: 10px;
            position: absolute;
            top: 10px;
            left: 10px;
        }
        
        .cius {
            position: relative;
            margin-bottom: 15px;
            right: 0px;
            width: 100%;
            bottom: 10px;
            height: 40px;
            background-color: white;
            border: none;
            padding-left: 7px;
        }
        
        #jieshour {
            float: left;
            font-size: 16px;
            position: relative;
            right: 10px;
        }
        
        .ciusd {
            font-size: 16px;
        }
        
        .jiantou {
            position: relative;
            left: 15px;
        }
    </style>

</head>

<body style="background-color: whitesmoke;">
    <div class="top_bo">
        <img src="__TMPL__public/img/img67.png" class="fanhui"> 待办事宜
        <div class="clearfix"></div>
    </div>


    </div>
    <input type="hidden" value={$userid} id="userid">
    <input type="hidden" value={$schoolid} id="schoolid">
    <input type="hidden" value={$scheduleid} id="scheduleid">
    <input type="hidden" value={$rid} id="rid">



    </div>

    <div class="last2" style="margin-top: 10px;">


        <div class="clearfix"></div>
        <div>
           发起人:{$name}
        </div>
    </div>
    <div class="last2" style="margin-top: 10px;">


        <div class="clearfix"></div>
        <div>
           发起内容:{$content}
        </div>
    </div>

    <div class="last2" style="margin-top: 10px;">


        <div class="clearfix"></div>
        <div>
            <textarea style="width: 100%;background-color: white;border: none;height: 100px;border-bottom: 1px solid #ebebeb;" placeholder="我的意见" id="dzcontent"></textarea>
        </div>
    </div>
    <div class="last2" style="height: 50px;">
        <div class="word" style="width: 100%;">

            <button class="btn  btn-lg cius" data-toggle="modal" data-target="#myModal">
                <img style="float: right;" class="jiantou" src="__TMPL__public/img/img53.png" alt="">
                <span id="jieshour" class="kejian">转派人</span><span class="ciusd" ></span>

            </button>

        </div>

        <div class="clearfix"></div>
    </div>

    <!-- 按钮触发模态框 -->

    <!-- 模态框（Modal） -->
    <div style="margin-top: 30px;" class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                    <h4 class="modal-title" id="myModalLabel">转派人</h4>
                </div>
                <div class="modal-body">
                    <!--中心内容-->
                    <div class="jiuop" style="overflow:auto;height: 300px;">

                    </div>
                </div>
                <!--<div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
                <button type="button" class="btn btn-primary">提交更改</button>
            </div>-->
            </div>
            <!-- /.modal-content -->
        </div>
        <!--老师ID-->
        <input type="hidden" class="teacheridG" value="" />
        <!--学生id-->
        <input type="hidden" id="jieshou" value="" />

        <!-- /.modal -->
    </div>
    <input type="submit" name="submit" id="submit" value="转派">
    <input type="submit" name="end" id="end" value="完结">
    <script>
        $("document").ready(function() {
            var userid = $("#userid").val(); //用户ID
            var schoolid = $("#schoolid").val();

            $(".cius").click(function() {
                $.ajax({
                    type: "post",
                    url: '__ROOT__/index.php/?g=apps&m=school&a=getteacherinfo',
                    async: true,
                    data: {
                        // studentid: 3460
                        schoolid: schoolid
                    },
                    dataType: 'json',
                    success: function(res) {

                        $(".jiuop").children().remove();
                        var htmls = "";
                        res = eval(res.data);
                        console.log(res);
                        for (var i = 0; i < res.length; i++) {
                            //var classname = res[i].classname; //学生所在的班级
                            //for (var k = 0; k < res[i].teacherlist.length; k++) {
                            phone = res[i].phone;
                            //老师的名字
                            name = res[i].name;
                            //老师的头像照片
                            photo = res[i].photo;
                            jdf = res[i].id;
//                                    var name = res[i].teacherlist[k].name //老师的名字
//                                    var photo = res[i].teacherlist[k].photo //老师的照片
//                                    var idf = res[i].teacherlist[k].id; //老师ID
                            htmls += '<div   data-dismiss="modal"  class="uio"  style="margin-top: 10px;">'
                            htmls += '<span><img src="{$Think.const.SR}' + photo + '" style="width: 50px;height: 50px;border-radius: 35px;"/></span>'
                            htmls += '<span class="huoqu" style="margin-left: 3%;">' + name + '</span>'
                            htmls += '<input type="hidden" class="teacherids" value="' + jdf + '"/>'
                            htmls += '</div>'
                            // }
                        }
                        $(".jiuop").append(htmls);
                        //$(".iou").text(classname);
                        $(".uio").click(function() {
                            var mui = $(".huoqu", this).text();
                            $(".ciusd").text(mui);
                            var zhis = $(".teacherids", this).val();
                            $(".teacheridG").val(zhis);

                        })

                    },
                    error: function() {
                        console.log('系统错误,请稍后重试');
                    }
                });


            })
        })



        //
        $(".ie2").click(function() {
            var zhi = $(".ie2").text();
            $(".iuy").text(zhi);
        })
        $(".ie4").click(function() {
            var zhi1 = $(".ie4").text();
            $(".iuy").text(zhi1);
        })

        //取消没有选择请假人的禁用按钮
        $(".cius").mouseover(function() {
            $(".cius").removeAttr("disabled");
        })
    </script>

    <script type="text/javascript">
        $('#submit').click(function() {
            var userid = $("#userid").val(); //用户ID
            var teacherid = $('.teacheridG').val();
            var content = $("#dzcontent").val();
            var schoolid = $("#schoolid").val();
            var scheduleid = $("#scheduleid").val();
            var rid = $("#rid").val();
            if(userid==teacherid){
                alert("不能转派自己");
                return;
            }
            //alert(teacherid);
            //return;
            //alert(rid);
            if (teacherid == "") {
                alert("请选择转派人");
                return;
            }
//
//            if (content == "") {
//                alert("消息的内容不能为空");
//                return;
//            }
                $.ajax({
                    url: "__ROOT__/index.php?g=apps&m=school&a=DoTask",
                    type: "post",
                    dataType: "json",
                    data: {
                        userid: userid,
                        reciveid: teacherid,
                        id: rid,
                        finish:0,
                        scheduleid: scheduleid,
                        feedback: content
                    },
                    success: function(res) {
                        var teacherid = $('.teacheridG').val();
                        var content = $("#dzcontent").val();
                        $.ajax({
                            url: "__ROOT__/index.php/Apps/SendTpl/t_notice",
                            type: "post",
                            dataType: "json",
                            data: {
                                uisid: teacherid,
                                content: content,
                                userid:userid,
                                type:4,
                                schoolid:schoolid
                            },
                            success: function(res) {

                            },
                            error: function(res) {

                            }
                        });
                        alert("转派成功");
                        location.href = "{:U('tasksList')}";
                    },
                    error: function(res) {
                        alert("发布失败 请稍后重试");
                    }
                });
                return;
            })
        $('#end').click(function() {
            var userid = $("#userid").val(); //用户ID
            var content = $("#dzcontent").val();
            var scheduleid = $("#scheduleid").val();
            var rid = $("#rid").val();
            $.ajax({
                url: "__ROOT__/index.php?g=apps&m=school&a=DoTask",
                type: "post",
                dataType: "json",
                data: {
                    userid: userid,
                    id:rid,
                    finish:1,
                    scheduleid: scheduleid,
                    feedback: content
                },
                success: function(res) {
                    alert("已完结");
                    location.href = "{:U('index')}";
                },
                error: function(res) {
                    alert("失败 请稍后重试");
                }
            });
            return;
        })
        $(".fanhui").click(function() {
            window.history.back();
        })
    </script>
</body>

</html>